$(document).ready(function () {
    SoSanhVBSN();

    if (getCookie("GuiderSDBS") != "1")
        htmlscroll();

  
    $("div.Tomtatvanban img").each(function () {
        if ($(this).attr("src").indexOf("http://") < 0 && $(this).attr("src").indexOf("//") < 0) {
            $(this).attr("src", "//news.thuvienphapluat.vn" + $(this).attr("src"));
        }
    });

    //    document.onkeyup = function (e) {
    //        if (e == null) { // ie
    //            keycode = event.keyCode;
    //        } else { // mozilla
    //            keycode = e.which;
    //        }
    //        if (keycode == 27) { // close
    //            return false;
    //        }
    //    };

    $a = $("div.content1 table a:contains('FILE ĐƯỢC')");
    if ($a == undefined || $a == "undefined" || $a.html() == null) {
        $a = $("div.content1 table a:contains('ĐÍNH KÈM THEO VĂN BẢN')");
    }
    if ($a == undefined || $a == "undefined" || $a.html() == null) {
        $a = $("div.content1 table a:contains('FILE ĐÍNH')");
    }

    $td = $("div.content1 table td:contains('FILE ĐƯỢC')");
    if ($td == undefined || $td == "undefined" || $td.html() == null) {
        $td = $("div.content1 table td:contains('ĐÍNH KÈM THEO VĂN BẢN')");
    }
    if ($td == undefined || $td == "undefined" || $td.html() == null) {
        $td = $("div.content1 table td:contains('FILE ĐÍNH')");
    }
    if ($a != undefined && $a != "undefined" && $a.html() != null) {

        $a.html("<span style='font-weight: bold;color: red;padding: 10px;'>Văn bản này có file đính kèm, bạn phải tải Văn bản về để xem toàn bộ nội dung.</span>");
        $a.attr("href", __urldl);
        $td.html($a[0].outerHTML);
    }
    else {

        $("div[align=center]>table td:contains('FILE ATTACHED')").html("<p style='font-weight: bold;color: red;padding: 10px;'>This document has attachments. You must download the document to see the entire contents.</p>");
        $("div[align=center]>table td:contains('ATTACHED FILE')").html("<p style='font-weight: bold;color: red;padding: 10px;'>This document has attachments. You must download the document to see the entire contents.</p>");
        $("div[align=center]>table td:contains('ATTACHED TO DOCUMENT')").html("<p style='font-weight: bold;color: red;padding: 10px;'>This document has attachments. You must download the document to see the entire contents.</p>");
        $td.html("<p style='font-weight: bold;color: red;padding: 10px;'><a href='" + __urldl + "'><span style='font-weight: bold;color: red;'>Văn bản này có file đính kèm, bạn phải tải Văn bản về để xem toàn bộ nội dung</span></a>.</p>");
    }



    $("div.content1 img").each(function () {
        if ($(this).attr("src").indexOf("http://") < 0 && $(this).attr("src").indexOf("EffectSeal.aspx") < 0) {
            $(this).attr("src", "//thuvienphapluat.vn/doc2htm/" + $(this).attr("src"));
        }
    });


    //            $("div.content1 .clsBookmark").css({ "background-color": "#fff", "border": "1px dotted #0084ff", "cursor": "pointer!important", "padding": "2px 5px", "color": "#e96800!important", "-webkit-border-radius": "5px", "-moz-border-radius": "5px", "-ms-border-radius": "5px", "-o-border-radius": "5px", "border-radius": "5px" , "line-height": "21px"});



});

function HT_Tootip_EffectDetail() {
    ddrivetip($(".htip").html(), 400);
}

function opentLogin() {
    $(".lgOp").show();
    $(".ipPhone").hide();
    $(".trLogin").show();
    $(".btnRegiter").val("Đăng ký");
    
    //    $("body").append("<div id='TB_overlay'></div><div id='TB_window'></div>");
    $(".lgOp .abcRioButton").html("<img src='/images/login-google.png' />");

    $("#TB_window").show();
    $(window).resize(TB_position);
    $(window).scroll(TB_position);

//    $("#TB_overlay").hide();
//    $("body").append("<div id='TB_load'><div id='TB_loadContent'><img src='/images/circle_animation.gif' /></div></div>");

//    $("#TB_window").append("<div id='TB_closeWindow' style='padding:0px'></div>" + "<div class='child1' style='    width: 750px;     height: 380px;     overflow: auto;'></div>");
    $("#TB_closeWindowButton").click(TB_remove);

//    $("#TB_window .child1").append($(".divLoginDL").html());

    TB_WIDTH = 750;
    TB_HEIGHT = 420;

    TB_position();
    $("#TB_load").remove();

    $("#TB_window").slideDown("normal");

    $(".btnRegiter").click(function () {

        $(this).hide();
        $("#loaddingRegiter").show();

        var params = "r_Add=" + $(".r_Add").val() + "&r_txtNameUser=" + $(".r_txtNameUser").val() + "&r_txtUser=" + $(".r_txtUser").val() + "&r_txtPass=" + $(".r_txtPass").val() + "&r_txtEmail=" + $(".r_txtEmail").val() + "&r_txtPhone=" + $(".r_txtPhone").val() + "&rt_chkAgree=" + $(".rt_chkAgree").attr("checked") + "&r_AppType=" + $(".r_AppType").val() + "&rt_action=" + rt_action + rt_action_tab;

        $.ajax({ 'url': '/page/ajaxcontroler.aspx',
            'data': params + '&action=Regiter',
            'type': 'POST',
            success: fnRegiter,
            error: function (response) {
            }
        });
    });

    $(".btnLogin").click(function () {

        $(this).hide();
        $("#loaddingLogin").show();
        var params = "&l_txtUser=" + $(".l_txtUser").val() + "&l_txtPass=" + $(".l_txtPass").val();

        $.ajax({ 'url': '/page/ajaxcontroler.aspx',
            'data': params + '&action=Login',
            'type': 'POST',
            success: fnLogin,
            error: function (response) {
            }
        });
    });


    function fnRegiter(response) {
        $("#loaddingRegiter").hide();
        $(".btnRegiter").show();
        if (response != "<ok>" && response != "") {
            alert(response.replace(/<br>/g, "\n"));
        }
        else {
            _gaq.push(['_trackEvent', 'UserActivity', 'RegisterArchive', 'Đăng ký NoLogin']);
            location.reload();
        }
    }
    function fnLogin(response) {
        $(".btnLogin").show();
        $("#loaddingLogin").hide();

        if (response != "<ok>" && response != "") {
            alert(response.replace(/<br>/g, "\n"));
        }
        else {
            location.reload();
        }
    }
}

var ii = 0;

function TB_remove() {
    if (ii > 0) {
        $("#TB_closeWindowButton").html("<span style='padding: 0 2px;color: red;font-weight: bold;border: 1px solid red;border-radius: 2px;'>"+ii+"</span>");
        ii = ii - 1;
        setTimeout(TB_remove, 1000);
    }
    else {
        $('#TB_window,#TB_overlay').hide(); 
        $("#TB_load").remove();

        $("#TB_closeWindowButton").html("<img src='/images/close-icon.png' width='14' height='14'>");
    }
}

function TB_position() {
    var pagesize = getPageSize();

    if (window.innerHeight && window.scrollMaxY) {
        yScroll = window.innerHeight + window.scrollMaxY;
    } else if (document.body.scrollHeight > document.body.offsetHeight) { // all but Explorer Mac
        yScroll = document.body.scrollHeight;
    } else { // Explorer Mac...would also work in Explorer 6 Strict, Mozilla and Safari
        yScroll = document.body.offsetHeight;
    }

    var arrayPageScroll = getPageScrollTop();

    $("#TB_window").css({ width: TB_WIDTH + "px", height: TB_HEIGHT + "px",
        left: ((pagesize[0] - TB_WIDTH) / 2) + "px", top: (arrayPageScroll[1] + ((pagesize[1] - TB_HEIGHT) / 2)) + "px"
    });
    $("#TB_overlay").css("height", yScroll + "px");

}




function parseQuery(query) {
    var Params = new Object();
    if (!query) return Params; // return empty object
    var Pairs = query.split(/[;&]/);
    for (var i = 0; i < Pairs.length; i++) {
        var KeyVal = Pairs[i].split('=');
        if (!KeyVal || KeyVal.length != 2) continue;
        var key = unescape(KeyVal[0]);
        var val = unescape(KeyVal[1]);
        val = val.replace(/\+/g, ' ');
        Params[key] = val;
    }
    return Params;
}


function getPageScrollTop() {
    var yScrolltop;
    if (self.pageYOffset) {
        yScrolltop = self.pageYOffset;
    } else if (document.documentElement && document.documentElement.scrollTop) {	 // Explorer 6 Strict
        yScrolltop = document.documentElement.scrollTop;
    } else if (document.body) {// all other Explorers
        yScrolltop = document.body.scrollTop;
    }
    arrayPageScroll = new Array('', yScrolltop)
    return arrayPageScroll;
}

function getPageSize() {
    var de = document.documentElement;
    var w = window.innerWidth || self.innerWidth || (de && de.clientWidth) || document.body.clientWidth;
    var h = window.innerHeight || self.innerHeight || (de && de.clientHeight) || document.body.clientHeight;

    arrayPageSize = new Array(w, h)
    return arrayPageSize;
}

var __Stop = false;
function SoSanhVBSN() {
}


var __closeSDBS = false;
var __StopHTML = false;
var _index = -1;
var _curentindex = -1;
var bmclass = "";
function htmlscroll() {

    var myGuider = guiders.createGuider({
        attachTo: ".clsBookmarkGuider",
        buttons: [],
        description: "<div class='ShowBMTip'><div class='mb5'> Các nội dung của VB này được VB khác thay đổi, hướng dẫn sẽ được làm nổi bật bằng      các màu sắc:</div><div>    <span class='SclsBookmark1'>&nbsp;&nbsp;&nbsp;&nbsp;</span> : Sửa đổi, thay thế,         hủy bỏ         </div>         <div>         <span class='SclsBookmark2'>&nbsp;&nbsp;&nbsp;&nbsp;</span> : Bổ sung         </div>         <div>         <span class='SclsBookmark3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> : Đính chính         </div>         <div>         <span class='SclsBookmark4'>&nbsp;&nbsp;&nbsp;&nbsp;</span> : Hướng dẫn         </div>   <div class='mt5'>  Click vào nội dung được bôi màu <span class='clsBookmark' style='cursor: default!important;'>&nbsp;&nbsp;&nbsp;&nbsp;</span>         để xem chi tiết.    </div> </div>    </div>",
        id: "GuiderSDBS",
        position: 6,
        width: 370,
        title: "Các nội dung được sửa đổi, hướng dẫn, ...",
        xButton: true
    });
    __StopHTML = false;
    $(".content1 a.clsBookmark").each(function myfunction(index) {
        var t = $(this).offset().top - $(window).scrollTop();

        if (t > 20 && t < ($(window).height() - 50)) {
            _index = index;
            $(this).addClass("clsBookmarkGuider");
            __StopHTML = true;
            var rr = $(this).attr('onmouseover').toString();

            if (rr.indexOf("Archive") < 0) {
                            bmclass = $(this).attr('atmm');
                        }
            return false;
        }
        else {
            $(this).removeClass("clsBookmarkGuider");
            __StopHTML = false;
        }
    });
    if (__StopHTML == true && _curentindex != _index && __closeSDBS == false) {
        _curentindex = _index;
        setTextBM(bmclass);
        guiders.show('GuiderSDBS');
    }
    $(window).scroll(function () {
        __StopHTML = false;
        $(".content1 a.clsBookmark").each(function myfunction(index) {
            var t = $(this).offset().top - $(window).scrollTop();

            if (t > 50 && t < ($(window).height() - 50)) {
                _index = index;
                $(this).addClass("clsBookmarkGuider");
                __StopHTML = true;
                var rr = $(this).attr('onmouseover').toString();
                if (rr.indexOf("Archive") < 0) {
                bmclass = $(this).attr('atmm');
                                }
                return false;
            }
            else {
                $(this).removeClass("clsBookmarkGuider");
                __StopHTML = false;
            }
        });

        if (__StopHTML == true && _curentindex != _index && __closeSDBS == false) {
            _curentindex = _index;
            setTextBM(bmclass);
            guiders.show('GuiderSDBS');
        }
    });
}

function setTextBM(val) {
    console.log(val);
    if (val != "" && val != undefined && val != null && val.indexOf(".") >= 0) {
        $(".ShowBMTip span").each(function myfunction() {
            if ($(this).attr("class") == "SclsBookmark1" || $(this).attr("class") == "SclsBookmark2" || $(this).attr("class") == "SclsBookmark3" || $(this).attr("class") == "SclsBookmark4") {
                $(this).parent().hide();
            }
        });

        $(val + " div").each(function myfunction() {
            var cl = $(this).attr("class");
            $(".ShowBMTip .S" + cl).parent().show();
        });
    }
}