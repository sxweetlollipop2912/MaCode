<!DOCTYPE html>
<!-- saved from url=(0050)http://www.movable-type.co.uk/scripts/latlong.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Calculate distance and bearing between two Latitude/Longitude points using haversine formula in JavaScript</title>
    
    <meta name="author" content="Chris Veness, www.movable-type.co.uk">
    <meta name="keywords" content="latitude longitude distance bearing points earth haversine great circle rhumb">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/normalize.min.css">
    <link rel="stylesheet" href="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/prettify.css">
    <link rel="stylesheet" href="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/base.css">
    <link rel="stylesheet" href="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/stylesheet.css">
    <link rel="stylesheet" href="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/mtl.css">
    <style>
        input               { text-align: right; width: 6em; }
        input[type="radio"] { width: auto; vertical-align: baseline; }
        output              { color: #000099; font-weight: bold; }
        a                   { cursor: pointer; } /* for 'show map' */
        figcaption          { font-size: 0.8em; font-style: italic; text-align: center; }
        form ul.list        { list-style: inherit; } /* an actual list to appear within a form! */
        fieldset            { padding: 0 2em; }
        .inputs             { float: left; margin: 1em 2em 0 0; }
        .outputs            { margin: 1em 2em 0 0; }
        .map                { height: 480px; width: 480px; }
        .radicand           { border-top: solid 1px #cccccc; }
        .label              { color: #666666; font-style: italic; }
        td.formula          { line-height: 1; padding: 0.4em 0.1em; }
        aside               { width: 21em; }
        .gm-style .gm-style-mtc div {
            font-size: 14px !important; /* shrink over-large map type control */
        }
        code.prettyprint {
            display: block;
            font-size: 0.8em;
            line-height: 1;;
            margin-left: 2.5em;
            padding-bottom: 0.4em;
            text-indent: -2.5em;
        }

        @media screen and (max-width: 800px) {
            .formula { font-size: 0.9em; /* Times a bit strange on Android? */ }
            figure img { width: 120px; }
        }
    </style>
    <script async="" src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/analytics.js.tải xuống"></script><script nomodule=""> window.location.replace('latlong-nomodule.html'); </script>
    <script defer="" src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/es6-promise.min.js.tải xuống">/* promise polyfill */</script>
    <script defer="" src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/fetch.min.js.tải xuống">/* fetch polyfill */</script>
    <script defer="" src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/prettify.js.tải xuống">/* r224/r298 don't work! */</script>
    <script defer="" src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/qs.min.js.tải xuống">/* github.com/ljharb/qs */</script>
    <script defer="" src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/js"></script>
    <script src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/js.cookie.min.js.tải xuống">/* github.com/js-cookie/js-cookie */</script>
    <!--[if lt IE 9]> <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script> <![endif]-->
    <script defer="" src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/mtl.js.tải xuống">/* MTL utils */</script>
    <script type="module" src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/latlong.js.tải xuống"></script>
<script type="text/javascript" charset="UTF-8" src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/common.js.tải xuống"></script><script type="text/javascript" charset="UTF-8" src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/util.js.tải xuống"></script></head>

<body>

<header> <a href="http://www.movable-type.co.uk/"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/mtl.gif" alt="MTL logo"></a>
  <h1>Movable Type Scripts</h1>
  <hr>
  <h2>Calculate distance, bearing and more between Latitude/Longitude points</h2>
</header>


<!--[if lte IE 9]><p class="alert align-left">This page no longer works on Internet Explorer 9 and earlier, which are <em><a href="https://www.microsoft.com/en-gb/WindowsForBusiness/End-of-IE-support">no longer supported</a></em></p><![endif]-->
<p class="error"></p>

<main>
    <p>This page presents a variety of calculations for lati­tude/longi­tude points, with the formulas and
        code fragments for implementing them.</p>
    <p>All these formulas are for calculations on the basis of a spherical earth  (ignoring ellipsoidal
        effects) – which is accurate enough<sup><a href="http://www.movable-type.co.uk/scripts/latlong.html#ellipsoid" title="see notes">*</a></sup> for
        most purposes… [In fact, the earth is very slightly ellipsoidal; using a spherical model gives
        errors typically up to 0.3%<sup><a href="http://gis.stackexchange.com/questions/25494#25580">1</a></sup>
        – see notes for further details].</p>

    <form name="ortho-dist" id="ortho-dist">
        <fieldset><legend>Great-circle distance between two points</legend>
            <p>Enter the co-ordinates into the text boxes to try out the calculations. A variety of
                formats are accepted, principally:</p>
            <ul class="list">
                <li>deg-min-sec suffixed with N/S/E/W (e.g. 40°44′55″N, 73 59 11W), or</li>
                <li>signed decimal degrees without compass direction, where negative indicates
                    west/south (e.g. 40.7486, -73.9864):
                </li>
            </ul>
            <table class="inputs">
                <tbody><tr>
                    <td>Point 1:</td>
                    <td>
                        <input type="text" name="lat1" class="lat1" value="50 03 59N" placeholder="Lat 1 (°N/S)" title="Lat 1 (°N/S)" required=""> ,
                        <input type="text" name="lon1" class="lon1" value="005 42 53W" placeholder="Lon 1 (°E/W)" title="Lon 1 (°E/W)" required="">
                    </td>
                </tr>
                <tr>
                    <td>Point 2:</td>
                    <td>
                        <input type="text" name="lat2" class="lat2" value="58 38 38N" placeholder="Lat 2 (°N/S)" title="Lat 2 (°N/S)" required=""> ,
                        <input type="text" name="lon2" class="lon2" value="003 04 12W" placeholder="Lon 2 (°E/W)" title="Lon 2 (°E/W)" required="">
                    </td>
                </tr>
            </tbody></table>
            <table class="outputs">
                <tbody><tr>
                    <td>Distance:</td>
                    <td>
                        <output class="result-dist" title="Distance (in km)">968.9</output> km
                        <span title="rounding to 4 significant figures reflects the approx. 0.3% accuracy of the spherical model" class="small grey">(to 4 SF<sup>*</sup>)</span>
                    </td>
                </tr>
                <tr>
                    <td>Initial bearing:</td>
                    <td><output class="result-brng1" title="Initial bearing (azimuth) between points">009° 07′ 11″</output></td>
                </tr>
                <tr>
                    <td>Final bearing:</td>
                    <td><output class="result-brng2" title="Final bearing (azimuth) between points">011° 16′ 31″</output></td>
                </tr>
                <tr>
                    <td>Midpoint:</td>
                    <td><output class="result-midpt" title="Midpoint between points">54° 21′ 44″ N, 004° 31′ 50″ W</output></td>
                </tr>
            </tbody></table>
            <p class="toggle-map">And you can <a>see it on a map</a></p>
            <p class="toggle-map hide"><a>... hide map</a></p>
            <div id="map-ortho-dist-canvas" class="map hide"></div>
        </fieldset>
    </form>


    <h3>Distance</h3>

    <p>This uses the ‘<b>haversine</b>’ formula to calculate the great-circle distance between two
        points – that is, the shortest distance over the earth’s surface – giving an ‘as-the-crow-flies’
        distance between the  points (ignoring any hills they fly over, of course!).</p>
    <table>
        <tbody><tr id="haversine">
            <td class="label" rowspan="3">Haversine<br>formula:</td>
            <td class="formula">a = sin²(Δφ/2) + cos φ<sub>1</sub> ⋅ cos φ<sub>2</sub> ⋅ sin²(Δλ/2)</td>
        </tr>
        <tr>
            <td class="formula">c = 2 ⋅ atan2( √<span class="radicand">a</span>, √<span class="radicand">(1−a)</span> )</td>
        </tr>
        <tr>
            <td class="formula">d = R ⋅ c</td>
        </tr>
        <tr>
            <td class="label align-right">where</td>
            <td><i></i>φ<i> is latitude, </i>λ<i> is longitude, </i>R<i> is earth’s radius (mean radius = 6,371km);<br>
                note that angles need to be in radians to pass to trig functions!</i></td>
        </tr>
        <tr>
            <td class="label">JavaScript:</td>
            <td><pre class="code prettyprint&gt;"><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> R </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">6371e3</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// metres</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> lat1</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> lat2</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δφ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lat2</span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln">lat1</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lon2</span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln">lon1</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">

</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> a </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(Δφ/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(Δφ/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln">
        </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln">
        </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(Δλ/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(Δλ/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> c </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">atan2</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sqrt</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">a</span></span><span class="pun"><span class="pun">),</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sqrt</span></span><span class="pun"><span class="pun">(</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln">a</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln">

</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> d </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> R </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> c</span></span><span class="pun"><span class="pun">;</span></span></pre>
            </td>
        </tr>
    </tbody></table>

    <p><i>Note in these scripts, I generally use lat/lon for lati­tude/longi­tude in degrees, and φ/λ for
        lati­tude/longi­tude in radians – having found that mixing degrees &amp; radians is often the
        easiest route to head-scratching bugs...</i></p>

    <aside><p><i>Historical aside</i>:
        The height of tech­nology for navigator’s calculations used to be log tables. As there is no
        (real) log of a negative number, the ‘versine’ enabled them to keep trig func­tions in
        positive numbers. Also, the sin²(θ/2) form of the haversine avoided addition (which en­tailed
        an anti-log lookup, the addi­tion, and a log lookup).
        Printed <a href="http://haversine.files.wordpress.com/2012/08/haversines.jpg">tables</a> for the
        haver­sine/in­verse-haver­sine (and its log­arithm, to aid
        multip­lica­tions) saved navi­gators from squaring sines, com­puting square roots,
        etc – arduous and error-prone activ­ities.</p>
    </aside>

    <p>The <a href="http://en.wikipedia.org/wiki/Haversine_formula">haversine</a>
        formula<sup><a href="http://mathforum.org/library/drmath/view/51879.html">1</a></sup> ‘remains
        particularly well-conditioned for numerical computa­tion even at small distances’ – unlike
        calcula­tions based on the <span title="cos c = cos a cos b + sin a sin b cos C"><i>spherical law
        of cosines</i></span>. The ‘(re)versed sine’ is <span class="formula">1−cosθ</span>, and the
        ‘half-versed-sine’ is <span class="formula">(1−cosθ)/2</span> or <span class="formula">sin²(θ/2)</span> as used above.
        Once widely used by navigators, it was described by Roger Sinnott in
        <a href="https://www.shopatsky.com/product/sky-and-telescope-august-1984-digital-issue/sky-and-telescope-digital-issues-1980-1989"><i>Sky &amp; Telescope</i></a>
        magazine in 1984 (“Virtues of the Haversine”): Sinnott explained that the angular separa­tion
        between Mizar and Alcor in Ursa Major – 0°11′49.69″ – could be accurately calculated on a
        <a href="http://en.wikipedia.org/wiki/TRS-80#modeliii">TRS-80</a> using the haversine.</p>
    <p>For the curious, <i>c</i> is the angular distance in radians, and <i>a</i> is the square of half
        the chord length between the points.</p>
    <p>If <code>atan2</code> is not available, <i>c</i> could be calculated
        from <span class="formula">2 ⋅ asin( min(1, √<span class="radicand">a</span>) )</span>
        (including protec­tion against rounding errors).</p>
    <p>Using Chrome on a middling Core i5 PC, a distance calcula­tion takes around
        <a href="http://www.movable-type.co.uk/scripts/performance/latlong-spherical.html">2 – 5 micro­seconds</a> (hence around 200,000 – 500,000 per second).
        Little to no benefit is obtained by factoring out common terms; probably the JIT compiler
        optimises them out.</p>

    <h4 id="cosine-law">Spherical Law of Cosines</h4>

    <p>In fact, JavaScript (and most modern computers &amp; languages) use ‘IEEE 754’ 64-bit floating-point
        numbers, which provide 15 significant figures of precision. By my estimate, with this precision,
        the simple <a href="http://mathworld.wolfram.com/SphericalTrigonometry.html">spherical law of
        cosines</a> formula (cos <i>c</i> = cos <i>a</i> cos <i>b</i> + sin <i>a</i> sin <i>b</i> cos <i>C</i>)
        gives well-condi­tioned results down to distances as small as a few metres on the earth’s surface.
        <span class="note">(<i>Note that the geodetic form of the law of cosines is rearranged from the
        canonical one so that the latitude can be used directly, rather than the
        <a href="http://mathworld.wolfram.com/Colatitude.html">colatitude</a></i>).</span></p>
    <p>This makes the simpler law of cosines a reasonable 1-line alternative to the haversine formula for
        many geodesy purposes (if not for astronomy). The choice may be driven by programming language, processor,
        coding context, available trig func­tions (in different languages), etc – and, for very small distances an
        equirectangular approxima­tion may be more suitable.</p>

    <table>
        <tbody><tr>
            <td class="label">Law of cosines:</td>
            <td class="formula">d = acos( sin φ<sub>1</sub> ⋅ sin φ<sub>2</sub> + cos φ<sub>1</sub> ⋅ cos φ<sub>2</sub> ⋅ cos Δλ ) ⋅ R</td>
        </tr>
        <tr>
            <td class="label">JavaScript:</td>
            <td><pre class="code prettyprint&gt;"><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> lat1</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">(),</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> lat2</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">(),</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lon2</span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln">lon1</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">(),</span></span><span class="pln"><span class="pln"> R </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">6371e3</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// gives d in metres</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> d </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">acos</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(Δλ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> R</span></span><span class="pun"><span class="pun">;</span></span></pre>
            </td>
        </tr>
        <tr>
            <td class="label">Excel:</td>
            <td class="code">=ACOS( SIN(lat1)*SIN(lat2) + COS(lat1)*COS(lat2)*COS(lon2-lon1) ) * 6371000</td>
        </tr>
        <tr>
            <td class="label">(or with lat/lon in degrees):</td>
            <td class="code">=ACOS( SIN(lat1*PI()/180)*SIN(lat2*PI()/180) + COS(lat1*PI()/180)*COS(lat2*PI()/180)*COS(lon2*PI()/180-lon1*PI()/180) ) * 6371000</td>
        </tr>
    </tbody></table>
    <p>While simpler, the law of cosines is slightly slower than the haversine, in my tests.</p>

    <h4 id="equirectangular">Equirectangular approximation</h4>

    <p>If performance is an issue and accuracy less important, for small distances
        <a href="http://en.wikipedia.org/wiki/Pythagorean_theorem">Pythagoras’
        theorem</a> can be used on an <a href="http://en.wikipedia.org/wiki/Equirectangular_projection">equi­rectangular
        projec­tion</a>:<sup title="merci à Laurent Grégoire">*</sup></p>
    <table>
        <tbody><tr>
            <td class="label">Formula</td>
            <td class="formula">x = Δλ ⋅ cos φ<sub>m</sub></td>
        </tr>
        <tr>
            <td></td>
            <td class="formula">y = Δφ</td>
        </tr>
        <tr>
            <td></td>
            <td class="formula">d = R ⋅ √<span class="radicand">x² + y²</span></td>
        </tr>
        <tr>
        <td class="label">JavaScript:</td>
        <td><pre class="code prettyprint&gt;"><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> x </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">-λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">((φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">+φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> y </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">-φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> d </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sqrt</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">x</span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln">x </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> y</span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln">y</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> R</span></span><span class="pun"><span class="pun">;</span></span></pre></td>
        </tr>
    </tbody></table>

    <p>This uses just one trig and one sqrt function – as against half-a-dozen trig func­tions for cos
        law, and 7 trigs + 2 sqrts for haversine. Accuracy is somewhat complex: along meridians there
        are no errors, otherwise they depend on distance, bearing, and latitude, but are small enough
        for many purposes<sup title="anyone care to quantify them?">*</sup> (and often trivial compared
        with the spherical approxima­tion itself).</p>

    <p>Alternatively, the <i>polar coordinate flat-earth formula</i> can be used:
        using the co-latitudes θ<sub>1</sub> = π/2−φ<sub>1</sub> and θ<sub>2</sub> = π/2−φ<sub>2</sub>,
        then <span class="formula nowrap">d = R ⋅ √<span class="radicand">θ<sub>1</sub>² + θ<sub>2</sub>² − 2 ⋅ θ<sub>1</sub> ⋅ θ<sub>2</sub> ⋅ cos Δλ</span></span>.
        I’ve not compared accuracy.</p>

    <figure class="float-right"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/baghdad-to-osaka.jpg" alt="Baghdad to Osaka">
        <figcaption>Baghdad to Osaka – <br>
        not a constant bearing!</figcaption>
    </figure>

    <h3 id="bearing">Bearing</h3>

    <p>In general, your current heading will vary as you  follow a great circle path (orthodrome); the
        final heading will differ from the initial heading by varying degrees according to distance and
        latitude (if you were to go from say 35°N,45°E (≈&nbsp;Baghdad) to 35°N,135°E (≈&nbsp;Osaka), you
        would start on a heading of 60° and end up on a heading of 120°!).</p>
    <p>This formula is for the initial bearing (sometimes referred to as forward azimuth) which if
        followed in a straight line along a great-circle arc will take you from the start point to the
        end point:<sup><a href="http://mathforum.org/library/drmath/view/55417.html">1</a></sup></p>
    <table>
        <tbody><tr>
            <td class="label">Formula:</td>
            <td class="formula">θ = atan2( sin Δλ ⋅ cos φ<sub>2</sub> , cos φ<sub>1</sub> ⋅ sin φ<sub>2</sub>  − sin φ<sub>1</sub> ⋅ cos φ<sub>2</sub> ⋅ cos Δλ )</td>
        </tr>
        <tr>
            <td class="label align-right">where</td>
            <td><i></i>φ<sub>1</sub><i>,</i>λ<sub>1</sub><i> is the start point,
                </i>φ<sub>2</sub><i>,</i>λ<sub>2</sub><i> the end point (</i>Δλ<i> is the difference in longitude)</i></td>
        </tr>
        <tr>
            <td class="label">JavaScript:<div class="small grey">(all angles <br>in radians)</div></td>
            <td><pre class="code prettyprint&gt;"><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> y </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">-λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> x </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln">
        </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">-λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> brng </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">atan2</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">y</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> x</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toDegrees</span></span><span class="pun"><span class="pun">();</span></span></pre></td>
        </tr>
        <tr>
            <td class="label">Excel:<div class="small grey">(all angles <br>in radians)</div></td>
            <td class="code nowrap">=ATAN2(COS(lat1)*SIN(lat2)-SIN(lat1)*COS(lat2)*COS(lon2-lon1), <br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SIN(lon2-lon1)*COS(lat2))
                <br><span class="note">*note that Excel reverses the arguments to ATAN2 – see notes below</span>
            </td>
        </tr>
    </tbody></table>
    <p class="note">Since atan2 returns values in the range -π ... +π (that is, -180° ... +180°), to
        normalise the result to a compass bearing (in the range 0° ... 360°, with −ve values transformed
        into the range 180° ... 360°), convert to degrees and then use (θ+360)&nbsp;%&nbsp;360, where %
        is (floating point) modulo.</p>
    <p class="note">For final bearing, simply take the <i>initial</i> bearing from the <i>end</i> point
        to the <i>start</i> point and reverse it (using θ = (θ+180) % 360).</p>

    <h3 id="midpoint">Midpoint</h3>

    <p>This is the half-way point along a great circle path between the two
        points.<sup><a href="http://mathforum.org/library/drmath/view/51822.html" title="Mathforum derivation">1</a></sup></p>
    <table>
        <tbody><tr>
            <td class="label">Formula:</td>
            <td class="formula">B<sub>x</sub> = cos φ<sub>2</sub> ⋅ cos Δλ</td>
        </tr>
        <tr>
            <td></td>
            <td class="formula">B<sub>y</sub> = cos φ<sub>2</sub> ⋅ sin Δλ</td>
        </tr>
        <tr>
            <td></td>
            <td class="formula">φ<sub>m</sub> = atan2( sin φ<sub>1</sub> + sin φ<sub>2</sub>,
                √<span class="radicand">(cos φ<sub>1</sub> + B<sub>x</sub>)² + B<sub>y</sub>²</span> )</td>
        </tr>
        <tr>
            <td></td>
            <td class="formula">λ<sub>m</sub> = λ<sub>1</sub> + atan2(B<sub>y</sub>, cos(φ<sub>1</sub>)+B<sub>x</sub>)</td>
        </tr>
        <tr>
            <td class="label">JavaScript:<div class="small grey">(all angles <br>in radians)</div></td>
            <td><pre class="code prettyprint&gt;"><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Bx</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">-λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">By</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">-λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">3</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">atan2</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">),</span></span><span class="pln"><span class="pln">
                    </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sqrt</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)+</span></span><span class="typ"><span class="typ">Bx</span></span><span class="pun"><span class="pun">)*(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)+</span></span><span class="typ"><span class="typ">Bx</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">By</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">By</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">3</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">atan2</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">By</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Bx</span></span><span class="pun"><span class="pun">);</span></span></pre></td>
        </tr>
        <tr>
            <td></td>
            <td class="note">The longitude can be normalised to −180…+180 using <code>(lon+540)%360-180</code></td>
        </tr>
    </tbody></table>

    <p class="note">Just as the initial bearing may vary from the final bearing, the midpoint may
        not be located half-way between latitudes/longitudes; the midpoint between 35°N,45°E
        and 35°N,135°E is around 45°N,90°E.</p>

    <h4 id="intermediate-point">Intermediate point</h4>

    <p>An intermediate point at any fraction along the great circle path between two points can also be
        calculated.<sup><a href="http://www.edwilliams.org/avform.htm#Intermediate" title="from Ed William’s aviation formulary">1</a></sup></p>

    <table>
        <tbody><tr>
            <td class="label">Formula:</td>
            <td class="formula">a = sin((1−f)⋅δ) / sin δ</td>
        </tr>
        <tr>
            <td></td>
            <td class="formula">b = sin(f⋅δ) / sin δ</td>
        </tr>
        <tr>
            <td></td>
            <td class="formula">x = a ⋅ cos φ<sub>1</sub> ⋅ cos λ<sub>1</sub> + b ⋅ cos φ<sub>2</sub> ⋅ cos λ<sub>2</sub></td>
        </tr>
        <tr>
            <td></td>
            <td class="formula">y = a ⋅ cos φ<sub>1</sub> ⋅ sin λ<sub>1</sub> + b ⋅ cos φ<sub>2</sub> ⋅ sin λ<sub>2</sub></td>
        </tr>
        <tr>
            <td></td>
            <td class="formula">z = a ⋅ sin φ<sub>1</sub> + b ⋅ sin φ<sub>2</sub></td>
        </tr>
        <tr>
            <td></td>
            <td class="formula">φ<sub>i</sub> = atan2(z, √<span class="radicand">x² + y²)</span></td>
        </tr>
        <tr>
            <td></td>
            <td class="formula">λ<sub>i</sub> = atan2(y, x)</td>
        </tr>
        <tr>
            <td class="label align-right">where</td>
            <td><i></i>f<i> is fraction along great circle route (f=0 is point 1, f=1 is point 2), </i>δ<i> is the angular
                distance </i>d/R<i> between the two points.</i></td>
        </tr>
    </tbody></table>
    <p>&nbsp;</p>

    <hr>

    <h3 id="dest-point"><b>Destination point given distance and bearing from start point</b></h3>

    <p id="destPoint">Given a start point, initial bearing, and distance, this will calculate the destina­tion point and
        final bearing travelling along a (shortest distance) great circle arc.</p>

    <form name="ortho-dest" id="ortho-dest">
        <fieldset><legend>Destination point along great-circle given distance and bearing from start point</legend>
            <table class="inputs">
                <tbody><tr>
                    <td>Start point:</td>
                    <td>
                        <input name="lat1" class="lat1" type="text" value="53°19′14″N">,
                        <input name="lon1" class="lon1" type="text" value="001°43′47″W">
                    </td>
                </tr>
                <tr>
                    <td>Bearing:</td>
                    <td><input type="text" name="brng" class="brng" value="096°01′18″"></td>
                </tr>
                <tr>
                    <td>Distance:</td>
                    <td><input name="dist" class="dist" type="number" step="any" value="124.8"> km</td>
                </tr>
            </tbody></table>
            <table class="outputs">
                <tbody><tr>
                    <td>Destination point:</td>
                    <td><output class="result-point" title="Destination point">53° 11′ 18″ N, 000° 08′ 00″ E</output></td>
                </tr>
                <tr>
                    <td>Final bearing:</td>
                    <td><output class="result-brng" title="Final bearing (azimuth) arriving at point 2">097° 30′ 52″</output></td>
                </tr>
                <tr>
                    <td>
                        <p class="toggle-map"><a>view map</a></p>
                        <p class="toggle-map hide"><a>hide map</a></p>
                    </td>
                    <td></td>
                </tr>
            </tbody></table>
            <div id="map-ortho-dest-canvas" class="map hide"></div>
        </fieldset>
    </form>

    <table>
        <tbody><tr>
            <td class="label">Formula: </td>
            <td class="formula">φ<sub>2</sub> = asin( sin φ<sub>1</sub> ⋅ cos δ + cos φ<sub>1</sub> ⋅ sin δ ⋅ cos θ )</td>
        </tr>
        <tr>
            <td></td>
            <td class="formula">λ<sub>2</sub> = λ<sub>1</sub> + atan2( sin θ ⋅ sin δ ⋅ cos φ<sub>1</sub>, cos δ − sin φ<sub>1</sub> ⋅ sin φ<sub>2</sub> )</td>
        </tr>
        <tr>
            <td class="label align-right">where</td>
            <td><i></i>φ<i> is latitude, </i>λ<i> is longitude, </i>θ<i> is the bearing (clockwise from north),
                δ is the angular distance </i>d/R<i>; </i>d<i> being the distance travelled, </i>R<i> the earth’s radius</i></td>
        </tr>
        <tr>
            <td class="label">JavaScript:<div class="small grey">(all angles <br>in radians)</div></td>
            <td><pre class="code prettyprint&gt;"><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">asin</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">d</span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln">R</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln">
                    </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">d</span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln">R</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">brng</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">atan2</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">brng</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">d</span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln">R</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">),</span></span><span class="pln"><span class="pln">
                         </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">d</span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln">R</span></span><span class="pun"><span class="pun">)-</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">));</span></span></pre></td>
        </tr>
        <tr>
            <td></td>
            <td class="note">The longitude can be normalised to −180…+180 using <code>(lon+540)%360-180</code></td>
        </tr>
        <tr>
            <td class="label">Excel:<div class="small grey">(all angles <br>in radians)</div></td>
            <td class="code">lat2: =ASIN(SIN(lat1)*COS(d/R) + COS(lat1)*SIN(d/R)*COS(brng))<br>
                lon2: =lon1 + ATAN2(COS(d/R)-SIN(lat1)*SIN(lat2), SIN(brng)*SIN(d/R)*COS(lat1))
                <br><span class="note">* Remember that Excel reverses the arguments to ATAN2 – see notes below</span></td>
        </tr>
    </tbody></table>

    <p class="note">For final bearing, simply take the <i>initial</i> bearing from the <i>end</i> point to the <i>start</i>
        point and reverse it with <code>(brng+180)%360</code>.</p>
    <p>&nbsp;</p>

    <hr>

    <h3 id="intersection">Intersection of two paths given start points and bearings</h3>

    <p>This is a rather more complex calculation than most others on this page, but I've been asked for it a number of times.
        This comes from Ed William’s <a href="http://www.edwilliams.org/avform.htm#Intersection">aviation formulary</a>.
        See below for the JavaScript.</p>

    <form name="intersect" id="intersect">
        <fieldset><legend>Intersection of two great-circle paths</legend>
            <table class="inputs">
                <tbody><tr>
                    <td>Point 1:</td>
                    <td>
                    <input name="lat1" class="lat1" type="text" value="51.8853 N" title="Latitude 1">,
                    <input name="lon1" class="lon1" type="text" value="0.2545 E" title="Longitude 1">
                    Brng 1:
                    <input name="brng1" class="brng1" type="text" value="108.55°" title="Bearing 1">
                    </td>
                </tr>
                <tr>
                    <td>Point 2:</td>
                    <td>
                    <input name="lat2" class="lat2" type="text" value="49.0034 N" title="Latitude 2">,
                    <input name="lon2" class="lon2" type="text" value="2.5735 E" title="Longitude 2">
                    Brng 2:
                    <input name="brng1" class="brng2" type="text" value="32.44°" title="Bearing 2">
                    </td>
                </tr>
            </tbody></table>
            <table class="outputs">
                <tbody><tr>
                    <td>Intersection point:</td>
                    <td><output class="result-point" title="Intersection point">50° 54′ 27″ N, 004° 30′ 31″ E</output></td>
                </tr>
                <tr>
                    <td colspan="2"><p>&nbsp;</p></td>
                </tr>
            </tbody></table>
        </fieldset>
    </form>

    <table class="clear-floats">
        <tbody><tr>
            <td class="label">Formula:</td>
            <td class="formula">δ<sub>12</sub> = 2⋅asin( √<span class="radicand">(sin²(Δφ/2) + cos φ<sub>1</sub> ⋅ cos φ<sub>2</sub> ⋅ sin²(Δλ/2))</span> )</td>
            <td class="small grey align-right">angular dist. p1–p2</td>
        </tr>
        <tr>
            <td></td>
            <td class="formula">θ<sub>a</sub> = acos( ( sin φ<sub>2</sub>  − sin φ<sub>1</sub> ⋅ cos δ<sub>12</sub> ) / ( sin δ<sub>12</sub> ⋅ cos φ<sub>1</sub> ) )<br>
                                θ<sub>b</sub> = acos( ( sin φ<sub>1</sub>  − sin φ<sub>2</sub> ⋅ cos δ<sub>12</sub> ) / ( sin δ<sub>12</sub> ⋅ cos φ<sub>2</sub> ) )</td>
            <td class="small grey align-right">initial / final bearings<br>between points 1 &amp; 2</td>
        </tr>
        <tr>
            <td></td>
            <td class="formula">if sin(λ<sub>2</sub>−λ<sub>1</sub>) &gt; 0<br>
                &nbsp;&nbsp;&nbsp;&nbsp;θ<sub>12</sub> = θ<sub>a</sub><br>
                &nbsp;&nbsp;&nbsp;&nbsp;θ<sub>21</sub> = 2π − θ<sub>b</sub><br>
                else<br>
                &nbsp;&nbsp;&nbsp;&nbsp;θ<sub>12</sub> = 2π − θ<sub>a</sub><br>
                &nbsp;&nbsp;&nbsp;&nbsp;θ<sub>21</sub> = θ<sub>b</sub></td>
            <td class="small grey align-right"></td>
        </tr>
        <tr>
            <td></td>
            <td class="formula">α<sub>1</sub> = θ<sub>13</sub> − θ<sub>12</sub><br>
                                α<sub>2</sub> = θ<sub>21</sub> − θ<sub>23</sub></td>
            <td class="small grey align-right">angle p2–p1–p3<br>angle p1–p2–p3</td>
        </tr>
        <tr>
            <td></td>
            <td class="formula">α<sub>3</sub> = acos( −cos α<sub>1</sub> ⋅ cos α<sub>2</sub> + sin α<sub>1</sub> ⋅ sin α<sub>2</sub> ⋅ cos δ<sub>12</sub> )</td>
            <td class="small grey align-right">angle p1–p2–p3</td>
        </tr>
        <tr>
            <td></td>
            <td class="formula">δ<sub>13</sub> = atan2( sin δ<sub>12</sub> ⋅ sin α<sub>1</sub> ⋅ sin α<sub>2</sub> , cos α<sub>2</sub> + cos α<sub>1</sub> ⋅ cos α<sub>3</sub> )</td>
            <td class="small grey align-right">angular dist. p1–p3</td>
        </tr>
        <tr>
            <td></td>
            <td class="formula">φ<sub>3</sub> = asin( sin φ<sub>1</sub> ⋅ cos δ<sub>13</sub> + cos φ<sub>1</sub> ⋅ sin δ<sub>13</sub> ⋅ cos θ<sub>13</sub> )</td>
            <td class="small grey align-right">p3 lat</td>
        </tr>
        <tr>
            <td></td>
            <td class="formula">Δλ<sub>13</sub> = atan2( sin θ<sub>13</sub> ⋅ sin δ<sub>13</sub> ⋅ cos φ<sub>1</sub> , cos δ<sub>13</sub> − sin φ<sub>1</sub> ⋅ sin φ<sub>3</sub> )</td>
            <td class="small grey align-right">long p1–p3</td>
        </tr>
        <tr>
            <td></td>
            <td class="formula">λ<sub>3</sub> = λ<sub>1</sub> + Δλ<sub>13</sub></td>
            <td class="small grey align-right">p3 long</td>
        </tr>
      <tr>
        <td class="label align-right"><i>where</i></td>
        <td><p><i>φ<sub>1</sub>, λ<sub>1</sub>, θ<sub>13</sub> : 1st start point &amp; (initial) bearing from 1st point towards intersection point<br>
          φ<sub>2</sub>, λ<sub>2</sub>, θ<sub>23</sub> : 2nd start point &amp; (initial) bearing from 2nd point towards intersection point<br>
          φ<sub>3</sub>, λ<sub>3</sub> : intersection point</i></p>
            <p><i>% = (floating point) modulo<!--, | | = abs--></i></p></td>
      </tr>
      <tr>
        <td class="label align-right">note –</td>
        <td>if sin α<sub>1</sub> = 0 and sin α<sub>2</sub> = 0: infinite solutions<br>
          if sin α<sub>1</sub> ⋅ sin α<sub>2</sub>  &lt; 0: ambiguous solution<br>
          this formulation is not always well-conditioned for meridional or equatorial lines</td>
      </tr>
    </tbody></table>
<p>This is a lot simpler using vectors rather than spherical trigonometry:
    see <a href="http://www.movable-type.co.uk/scripts/latlong-vectors.html#intersection">latlong-vectors.html</a>.</p>
<hr>

<h3 id="cross-track">Cross-track distance</h3>

<p>Here’s a new one:  I’ve sometimes been asked about distance of a point from a great-circle path
    (sometimes called cross track error).</p>

<table>
    <tbody><tr>
        <td class="label">Formula: </td>
        <td class="formula">d<sub>xt</sub> = asin( sin(δ<sub>13</sub>) ⋅ sin(θ<sub>13</sub>−θ<sub>12</sub>) ) ⋅ R</td>
    </tr>
    <tr>
        <td class="label align-right"><i>where</i></td>
        <td><i>
            δ<sub>13</sub> is (angular) distance from start point to third point<br>
            θ<sub>13</sub> is (initial) bearing from start point to third point<br>
            θ<sub>12</sub> is (initial) bearing from start point to end point<br>
            R is the earth’s radius<br>
            </i>
        </td>
    </tr>
    <tr>
        <td class="label">JavaScript:</td>
        <td><pre class="code prettyprint&gt;"><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">δ</span></span><span class="lit"><span class="lit">13</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> d13 </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> R</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> dXt </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">asin</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(δ</span></span><span class="lit"><span class="lit">13</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(θ</span></span><span class="lit"><span class="lit">13</span></span><span class="pun"><span class="pun">-θ</span></span><span class="lit"><span class="lit">12</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> R</span></span><span class="pun"><span class="pun">;</span></span></pre></td>
    </tr>
</tbody></table>

<p>Here, the great-circle path is identified by a start point and an end point – depending on what initial data you’re working from,
    you can use the formulas above to obtain the relevant distance and bearings.
    The sign of d<sub>xt</sub> tells you which side of the path the third point is on.</p>
<p>The along-track distance, from the start point to the closest point on the path to the third point, is</p>
<table>
    <tbody><tr>
        <td class="label">Formula: </td>
        <td class="formula">d<sub>at</sub> = acos( cos(δ<sub>13</sub>) / cos(δ<sub>xt</sub>) ) ⋅ R</td>
    </tr>
    <tr>
        <td class="label align-right"><i>where</i></td>
        <td><i>
            δ<sub>13</sub> is (angular) distance from start point to third point<br>
            δ<sub>xt</sub> is (angular) cross-track distance<br>
            R is the earth’s radius<br>
            </i>
        </td>
    </tr>
    <tr>
        <td class="label">JavaScript:</td>
        <td><pre class="code prettyprint&gt;"><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">δ</span></span><span class="lit"><span class="lit">13</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> d13 </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> R</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> dAt </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">acos</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(δ</span></span><span class="lit"><span class="lit">13</span></span><span class="pun"><span class="pun">)/</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">dXt</span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln">R</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> R</span></span><span class="pun"><span class="pun">;</span></span></pre></td>
    </tr>
</tbody></table>

<h3 id="clairaut">Closest point to the poles</h3>

<p>And: ‘Clairaut’s formula’ will give you the maximum latitude of a great circle path,
  given a bearing θ and latitude φ on the great circle:
</p><table>
    <tbody><tr>
        <td class="label">Formula: </td>
        <td class="formula">φ<sub>max</sub> = acos( | sin θ ⋅ cos φ | )</td>
    </tr>
    <tr>
        <td class="label">JavaScript:</td>
        <td><pre class="code prettyprint&gt;"><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="typ"><span class="typ">Max</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">acos</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">abs</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(θ)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ)));</span></span></pre></td>
    </tr>
</tbody></table>
<p>&nbsp;</p>

<hr>

<h3 id="rhumblines">Rhumb lines</h3>

<p>A ‘rhumb line’ (or loxodrome) is a path of constant bearing, which crosses all meridians at the
    same angle.</p>
<p>Sailors used to (and sometimes still) navigate along rhumb lines since it is easier to follow
    a constant compass  bearing than to be continually adjusting the bearing, as is needed to follow
    a great circle. Rhumb lines are straight lines on a Mercator Projec­tion map (also helpful for
    naviga­tion).</p>
<p>Rhumb lines are generally longer than great-circle (orthodrome) routes. For instance, London to New
    York is  4% longer along a rhumb line than along a great circle – important for avia­tion fuel,
    but not particularly to sailing vessels. New York to Beijing – close to the most extreme example
    possible (though not sailable!) – is 30% longer along a rhumb line.</p>

<form name="rhumb-dist" id="rhumb-dist">
    <fieldset><legend>Rhumb-line distance between two points</legend>
        <table class="inputs">
            <tbody><tr>
                <td>Point 1:</td>
                <td>
                <input name="lat1" class="lat1" type="text" value="50 21 59N" title="Latitude 1">,
                <input name="lon1" class="lon1" type="text" value="004 08 02W" title="Longitude 1">
                </td>
            </tr>
            <tr>
                <td>Point 2:</td>
                <td>
                <input name="lat2" class="lat2" type="text" value="42 21 04N" title="Latitude 2">,
                <input name="lon2" class="lon2" type="text" value="071 02 27W" title="Longitude 2">
                </td>
            </tr>
        </tbody></table>
        <table class="outputs">
            <tbody><tr>
                <td>Distance:</td>
                <td><output class="result-dist" title="Distance (in km)">5198</output> km</td>
            </tr>
            <tr>
                <td>Bearing:</td>
                <td><output class="result-brng" title="Bearing (azimuth) between points">260° 07′ 38″</output></td>
            </tr>
            <tr>
                <td>Midpoint:</td>
                <td><output class="result-midpt" title="Midpoint between points">46° 21′ 32″ N, 038° 49′ 00″ W</output></td>
            </tr>
            <tr>
                <td>
                    <p class="toggle-map"><a>view map</a></p>
                    <p class="toggle-map hide"><a>hide map</a></p>
                </td>
                <td></td>
            </tr>
        </tbody></table>
        <div id="map-rhumb-dist-canvas" class="map hide"></div>
    </fieldset>
</form>

<form name="rhumb-dest" id="rhumb-dest" class="demo">
    <fieldset><legend>Destination point along rhumb line given distance and bearing from start point</legend>
        <table class="inputs">
            <tbody><tr>
                <td>Start point:</td>
                <td>
                    <input name="lat1" class="lat1" type="text" value="51 07 32N">,
                    <input name="lon1" class="lon1" type="text" value="001 20 17E">
                </td>
            </tr>
            <tr>
                <td>Bearing:</td>
                <td><input name="brng" class="brng" type="text" value="116°38′10"></td>
            </tr>
            <tr>
                <td>Distance:</td>
                <td><input name="dist" class="dist" type="number" step="any" value="40.23">
                km</td>
            </tr>
        </tbody></table>
        <table class="outputs">
            <tbody><tr>
                <td>Destination point:</td>
                <td><output class="result-point" title="Destination points">50° 57′ 48″ N, 001° 51′ 09″ E</output></td>
            </tr>
            <tr>
                <td>
                    <p class="toggle-map"><a>view map</a></p>
                    <p class="toggle-map hide"><a>hide map</a></p>
                </td>
                <td></td>
            </tr>
        </tbody></table>
        <div id="map-rhumb-dest-canvas" class="map hide"></div>
        <p>&nbsp;</p>
    </fieldset>
</form>

<p>Key to calculations of rhumb lines is the <i>inverse Gudermannian
    func­tion</i><a href="http://mathworld.wolfram.com/InverseGudermannian.html">¹</a>, which gives
    the height on a Mercator projec­tion map of a given latitude:
    <span class="formula">ln(tanφ + secφ)</span> or <span class="formula">ln( tan(π/4+φ/2) )</span>.
    This of course tends to infinity at the poles (in keeping with the Mercator projec­tion).
    <span class="grey">For obsessives, there is even an ellipsoidal version, the ‘isometric latitude’:
    <span class="formula">ψ = ln( tan(π/4+φ/2) / [ (1−e⋅sinφ) / (1+e⋅sinφ)&nbsp;]<sup>e/2</sup>)</span>,
    or its better-conditioned equivalent <span class="formula">ψ = atanh(sinφ) − e⋅atanh(e⋅sinφ)</span>.</span>
</p>
<p>The formulas to derive Mercator projection easting and northing coordinates from spherical latitude
    and longitude are then<a href="http://www.epsg.org/guides/docs/g7-2.pdf">¹</a></p>
<table class="width-full">
    <tbody><tr>
        <td></td>
        <td class="formula">E = R ⋅ λ</td>
    </tr>
    <tr>
        <td></td>
        <td class="formula">N = R ⋅ ln( tan(π/4 + φ/2) )</td>
    </tr>
</tbody></table>
<p>The following formulas are from Ed Williams’ aviation formulary.<a href="http://www.edwilliams.org/avform.htm#Rhumb">¹</a></p>

<h4 id="rhumb-distance">Distance</h4>

<p>Since a rhumb line is a straight line on a Mercator projec­tion, the distance between two points
    along a rhumb line is the length of that line (by Pythagoras); but the distor­tion of the
    projec­tion needs to be compensated for.</p>
<p>On a constant latitude course (travelling east-west), this compensa­tion is simply
    <span class="formula">cosφ</span>; in the general case, it is <span class="formula">Δφ/Δψ</span>
    where <span class="formula">Δψ = ln( tan(π/4 + φ<sub>2</sub>/2) / tan(π/4 + φ<sub>1</sub>/2) )</span>
    (the ‘projected’ latitude difference)</p>
<table class="width-full">
    <tbody><tr>
        <td class="label">Formula: </td>
        <td class="formula">Δψ = ln( tan(π/4 + φ<sub>2</sub>/2) / tan(π/4 + φ<sub>1</sub>/2) )</td>
        <td class="small grey align-right">(‘projected’ latitude difference)</td>
    </tr>
    <tr>
        <td></td>
        <td class="formula">q = Δφ/Δψ (or cosφ for E-W line)</td>
        <td></td>
    </tr>
    <tr>
        <td></td>
        <td class="formula">d = √<span class="radicand">(Δφ² + q²⋅Δλ²)</span> ⋅ R</td>
        <td class="small grey align-right">(Pythagoras)</td>
    </tr>
    <tr>
        <td class="label align-right">where</td>
        <td colspan="2">φ <i>is latitud</i>e, λ <i>is longitude</i>,
            Δλ<i> is taking shortest route (&lt;180°),
            </i>R<i> is the earth’s radius</i>, ln<i> is natural log</i></td>
    </tr>
    <tr>
        <td class="label">JavaScript:<div class="small grey">(all angles <br>in radians)</div></td>
        <td colspan="2"><pre class="code prettyprint&gt;"><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δψ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">log</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">4</span></span><span class="pun"><span class="pun">+φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)/</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">4</span></span><span class="pun"><span class="pun">+φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> q </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">abs</span></span><span class="pun"><span class="pun">(Δψ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&gt;</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">10e-12</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">?</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δφ/Δψ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// E-W course becomes ill-conditioned with 0/0</span></span><span class="pln"><span class="pln">

</span></span><span class="com"><span class="com">// if dLon over 180° take shorter rhumb line across the anti-meridian:</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">abs</span></span><span class="pun"><span class="pun">(Δλ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&gt;</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ&gt;</span></span><span class="lit"><span class="lit">0</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">?</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-(</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">-Δλ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">+Δλ);</span></span><span class="pln"><span class="pln">

</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> dist </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sqrt</span></span><span class="pun"><span class="pun">(Δφ*Δφ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> q</span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln">q</span></span><span class="pun"><span class="pun">*Δλ*Δλ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> R</span></span><span class="pun"><span class="pun">;</span></span></pre>
        </td>
    </tr>
</tbody></table>

<h4 id="rhumb-bearing">Bearing</h4>

<p>A rhumb line is a straight line on a Mercator projection, with an angle on the projec­tion equal
    to the compass bearing.</p>

<table class="width-full">
    <tbody><tr>
        <td class="label">Formula: </td>
        <td class="formula">Δψ = ln( tan(π/4 + φ<sub>2</sub>/2) / tan(π/4 + φ<sub>1</sub>/2) )</td>
        <td class="small grey align-right">(‘projected’ latitude difference)</td>
    </tr>
    <tr>
        <td></td>
        <td class="formula">θ = atan2(Δλ, Δψ)</td>
        <td></td>
    </tr>
    <tr>
        <td class="label align-right">where</td>
        <td colspan="2">φ <i>is latitud</i>e, λ <i>is longitude</i>,
            Δλ<i> is taking shortest route (&lt;180°),
            </i>R<i> is the earth’s radius</i>, ln<i> is natural log</i></td>
    </tr>
    <tr>
        <td class="label">JavaScript:<div class="small grey">(all angles <br>in radians)</div></td>
        <td colspan="2"><pre class="code prettyprint&gt;"><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δψ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">log</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">4</span></span><span class="pun"><span class="pun">+φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)/</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">4</span></span><span class="pun"><span class="pun">+φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln">

</span></span><span class="com"><span class="com">// if dLon over 180° take shorter rhumb line across the anti-meridian:</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">abs</span></span><span class="pun"><span class="pun">(Δλ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&gt;</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ&gt;</span></span><span class="lit"><span class="lit">0</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">?</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-(</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">-Δλ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">+Δλ);</span></span><span class="pln"><span class="pln">

</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> brng </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">atan2</span></span><span class="pun"><span class="pun">(Δλ,</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δψ).</span></span><span class="pln"><span class="pln">toDegrees</span></span><span class="pun"><span class="pun">();</span></span></pre></td>
    </tr>
</tbody></table>

<h4 id="rhumb-destination">Destination</h4>

<p>Given a start point and a distance <i>d</i> along constant bearing <i>θ</i>, this will calculate
    the destina­tion point. If you maintain a constant bearing along a rhumb line, you will gradually
    spiral in towards one of the poles. </p>
<table class="width-full">
    <tbody><tr>
        <td class="label">Formula: </td>
        <td class="formula">δ = d/R</td>
        <td class="small grey align-right">(angular distance)</td>
    </tr>
    <tr>
        <td></td>
        <td class="formula">φ<sub>2</sub> = φ<sub>1</sub> + δ ⋅ cos θ</td>
        <td></td>
    </tr>
    <tr>
        <td></td>
        <td class="formula">Δψ = ln( tan(π/4 + φ<sub>2</sub>/2) / tan(π/4 + φ<sub>1</sub>/2) )</td>
        <td class="small grey align-right">(‘projected’ latitude difference)</td>
    </tr>
    <tr>
        <td></td>
        <td class="formula">q = Δφ/Δψ (or cos φ for E-W line)</td>
        <td></td>
    </tr>
    <tr>
        <td></td>
        <td class="formula">Δλ = δ ⋅ sin θ / q</td>
        <td></td>
    </tr>
    <tr>
        <td></td>
        <td class="formula">λ<sub>2</sub> = λ<sub>1</sub> + Δλ</td>
        <td></td>
    </tr>
    <tr>
        <td class="label align-right">where</td>
        <td colspan="2">φ <i>is latitude</i>, λ <i>is longitude</i>, Δλ <i>is taking shortest route
            (&lt;180°), </i>ln<i> is natural log, </i>R<i> is the earth’s radius</i></td>
    </tr>
    <tr>
        <td class="label">JavaScript:<div class="small grey">(all angles <br>in radians)</div></td>
        <td colspan="2"><pre class="code prettyprint&gt;"><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">δ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> d</span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln">R</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δφ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">δ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(θ);</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δφ;</span></span><span class="pln"><span class="pln">

</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δψ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">log</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">+</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">4</span></span><span class="pun"><span class="pun">)/</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">+</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">4</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> q </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">abs</span></span><span class="pun"><span class="pun">(Δψ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&gt;</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">10e-12</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">?</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δφ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δψ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// E-W course becomes ill-conditioned with 0/0</span></span><span class="pln"><span class="pln">

</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">δ*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(θ)/</span></span><span class="pln"><span class="pln">q</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ;</span></span><span class="pln"><span class="pln">

</span></span><span class="com"><span class="com">// check for some daft bugger going past the pole, normalise latitude if so</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">abs</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&gt;</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">&gt;</span></span><span class="lit"><span class="lit">0</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">?</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">-φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">-φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">;</span></span></pre></td>
    </tr>
    <tr>
        <td></td>
        <td colspan="2" class="note">The longitude can be normalised to −180…+180 using <code>(lon+540)%360-180</code></td>
    </tr>
</tbody></table>

<h4>Mid-point</h4>

<p>This formula for calculating the ‘loxodromic midpoint’, the point half-way along a rhumb line
    between two points, is due to Robert Hill and Clive
    Tooth<sup><a href="http://mathforum.org/kb/message.jspa?messageID=148837">1</a></sup> (thx
    Axel!).</p>

<table>
    <tbody><tr>
        <td class="label">Formula: </td>
        <td class="formula">φ<sub>m</sub> = (φ<sub>1</sub>+φ<sub>2</sub>) / 2</td>
    </tr>
    <tr>
        <td></td>
        <td class="formula">f<sub>1</sub> = tan(π/4 + φ<sub>1</sub>/2)</td>
    </tr>
    <tr>
        <td></td>
        <td class="formula">f<sub>2</sub> = tan(π/4 + φ<sub>2</sub>/2)</td>
    </tr>
    <tr>
        <td></td>
        <td class="formula">f<sub>m</sub> = tan(π/4+φ<sub>m</sub>/2)</td>
    </tr>
    <tr>
        <td></td>
        <td class="formula">λ<sub>m</sub> = [ (λ<sub>2</sub>−λ<sub>1</sub>) ⋅ ln(f<sub>m</sub>) +
            λ<sub>1</sub> ⋅ ln(f<sub>2</sub>) − λ<sub>2</sub> ⋅ ln(f<sub>1</sub>) ] /
            ln(f<sub>2</sub>/f<sub>1</sub>)</td>
    </tr>
    <tr>
        <td class="label align-right">where</td>
        <td>φ <i>is latitude</i>, λ <i>is longitude</i>, ln <i>is natural log</i></td>
    </tr>
    <tr>
        <td class="label">JavaScript:<div class="small grey">(all angles <br>in radians)</div></td>
        <td>
            <pre class="code prettyprint&gt;"><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">abs</span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">-λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&gt;</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+=</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// crossing anti-meridian</span></span><span class="pln"><span class="pln">

</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">3</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">+φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> f1 </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">4</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> f2 </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">4</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> f3 </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">4</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">3</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">3</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">-λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">log</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">f3</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">log</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">f2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">log</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">f1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">log</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">f2</span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln">f1</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">

</span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(!</span></span><span class="pln"><span class="pln">isFinite</span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">3</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">3</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">+λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// parallel of latitude</span></span></pre>
        </td>
    </tr>
    <tr>
        <td></td>
        <td class="note">The longitude can be normalised to −180…+180 using <code>(lon+540)%360-180</code></td>
    </tr>
</tbody></table>
<hr>

<h3 id="using">Using the scripts in web pages</h3>

<p>Using these scripts in web pages would be something like the following:</p>
<pre class="prettyprint margin-l-1cm"><span class="dec"><span class="dec">&lt;!doctype html&gt;</span></span><span class="pln"><span class="pln">
</span></span><span class="tag"><span class="tag">&lt;html</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">lang</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"en"</span></span><span class="tag"><span class="tag">&gt;</span></span><span class="pln"><span class="pln">
</span></span><span class="tag"><span class="tag">&lt;head&gt;</span></span><span class="pln"><span class="pln">
    </span></span><span class="tag"><span class="tag">&lt;title&gt;</span></span><span class="pln"><span class="pln">Using the scripts in web pages</span></span><span class="tag"><span class="tag">&lt;/title&gt;</span></span><span class="pln"><span class="pln">
    </span></span><span class="tag"><span class="tag">&lt;meta</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">charset</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"utf-8"</span></span><span class="tag"><span class="tag">&gt;</span></span><span class="pln"><span class="pln">
    </span></span><span class="tag"><span class="tag">&lt;script</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">type</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"module"</span></span><span class="tag"><span class="tag">&gt;</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">import</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pln"><span class="pln"> from </span></span><span class="str"><span class="str">'https://cdn.jsdelivr.net/npm/geodesy@2/latlon-spherical.min.js'</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
        document</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">addEventListener</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">'DOMContentLoaded'</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">function</span></span><span class="pun"><span class="pun">()</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
            document</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">querySelector</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">'#calc-dist'</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">onclick </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">function</span></span><span class="pun"><span class="pun">()</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
                calculateDistance</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
            </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">
        </span></span><span class="pun"><span class="pun">});</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">function</span></span><span class="pln"><span class="pln"> calculateDistance</span></span><span class="pun"><span class="pun">()</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
            </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> p1 </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">parse</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">document</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">querySelector</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">'#point1'</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">value</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
            </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> p2 </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">parse</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">document</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">querySelector</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">'#point2'</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">value</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
            </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> dist </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> parseFloat</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">p1</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">distanceTo</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">p2</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toPrecision</span></span><span class="pun"><span class="pun">(</span></span><span class="lit"><span class="lit">4</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln">
            document</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">querySelector</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">'#result-distance'</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">textContent </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> dist </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">' metres'</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
        </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">
    </span></span><span class="tag"><span class="tag">&lt;/script&gt;</span></span><span class="pln"><span class="pln">
</span></span><span class="tag"><span class="tag">&lt;/head&gt;</span></span><span class="pln"><span class="pln">
</span></span><span class="tag"><span class="tag">&lt;body&gt;</span></span><span class="pln"><span class="pln">
</span></span><span class="tag"><span class="tag">&lt;form&gt;</span></span><span class="pln"><span class="pln">
    Point 1: </span></span><span class="tag"><span class="tag">&lt;input</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">type</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"text"</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">name</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"point1"</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">id</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"point1"</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">placeholder</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"lat1,lon1"</span></span><span class="tag"><span class="tag">&gt;</span></span><span class="pln"><span class="pln">
    Point 2: </span></span><span class="tag"><span class="tag">&lt;input</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">type</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"text"</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">name</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"point2"</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">id</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"point2"</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">placeholder</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"lat2,lon2"</span></span><span class="tag"><span class="tag">&gt;</span></span><span class="pln"><span class="pln">
    </span></span><span class="tag"><span class="tag">&lt;button</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">type</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"button"</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">id</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"calc-dist"</span></span><span class="tag"><span class="tag">&gt;</span></span><span class="pln"><span class="pln">Calculate distance</span></span><span class="tag"><span class="tag">&lt;/button&gt;</span></span><span class="pln"><span class="pln">
    </span></span><span class="tag"><span class="tag">&lt;output</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">id</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"result-distance"</span></span><span class="tag"><span class="tag">&gt;&lt;/output&gt;</span></span><span class="pln"><span class="pln">
</span></span><span class="tag"><span class="tag">&lt;/form&gt;</span></span><span class="pln"><span class="pln">
</span></span><span class="tag"><span class="tag">&lt;/body&gt;</span></span><span class="pln"><span class="pln">
</span></span><span class="tag"><span class="tag">&lt;/html&gt;</span></span></pre>
<hr>

<h3 id="convert-dec-dms">Convert between degrees-minutes-seconds &amp; decimal degrees</h3>

<form name="convert" id="convert">
    <table class="note">
        <tbody><tr>
            <td></td>
            <td>Latitude</td>
            <td>Longitude</td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td>d</td>
            <td><input type="text" name="lat-d" id="lat-d" value="51.47788" class="convert-lat note w8"></td>
            <td><input type="text" name="lon-d" id="lon-d" value="-0.00147" class="convert-lon note w8"></td>
            <td colspan="2">1° ≈ 111 km <span class="grey">(110.57 eq’l — 111.70 polar)</span></td>
        </tr>
        <tr>
            <td>dm</td>
            <td><input type="text" name="lat-dm" id="lat-dm" class="convert-lat note w8"></td>
            <td><input type="text" name="lon-dm" id="lon-dm" class="convert-lon note w8"></td>
            <td>1′ ≈ 1.85 km <span class="grey">(= 1 nm)</span></td>
            <td>0.01° ≈ 1.11 km</td>
        </tr>
        <tr>
            <td>dms</td>
            <td><input type="text" name="lat-dms" id="lat-dms" class="convert-lat note w8"></td>
            <td><input type="text" name="lon-dms" id="lon-dms" class="convert-lon note w8"></td>
            <td>1″ ≈ 30.9 m</td>
            <td>0.0001° ≈ 11.1 m</td>
        </tr>
    </tbody></table>
</form>

<form>Display calculation results as:
    <input type="radio" name="deg-format" id="deg-format-d" value="d"> <span title="decimal">degrees</span>
    <input type="radio" name="deg-format" id="deg-format-dm" value="dm"> <span title="sow’s ear">deg/min</span>
    <input type="radio" name="deg-format" id="deg-format-dms" value="dms"> <span title="sexagesimal">deg/min/sec</span>
</form>

<hr>

<p id="notes"><i>Notes:</i></p>
<ul class="note">
    <li id="ellipsoid">Accuracy: since the earth is not quite a sphere, there are small errors in
        using spherical geometry; the earth is actually roughly <b>ellipsoidal</b> (or more precisely,
        oblate spheroidal) with a radius varying between about 6,378km (equatorial) and 6,357km (polar),
        and local radius of curvature varying from 6,336km (equatorial meridian) to 6,399km (polar).
        6,371 km is the generally accepted value for the earth’s
        <a href="http://en.wikipedia.org/wiki/Earth_radius#Mean_radius">mean radius</a>. This means that errors
        from assuming spherical geometry might be up to 0.55% crossing the equator, though generally
        below 0.3%, depending on latitude and direction of travel (<i>whuber</i> explores this in excellent
        detail on <a href="http://gis.stackexchange.com/questions/25494#25580">stackexchange</a>).
        An accuracy of better than 3m in 1km is mostly good enough for me, but if you want greater
        accuracy, you could use the <a href="http://www.movable-type.co.uk/scripts/latlong-vincenty.html">Vincenty</a> formula for
        calculating geodesic distances on ellipsoids, which gives results accurate to within 1mm.
        (Out of sheer perversity – I’ve never needed such accuracy – I looked up this formula and
        discovered the JavaScript implementation was simpler than I expected).</li>
    <li>Trig functions take arguments in <b>radians</b>, so latitude, longitude, and bearings in
        <b>degrees</b> (either decimal or degrees/minutes/seconds) need to be converted to radians,
        rad = π.deg/180. When converting radians back to degrees (deg = 180.rad/π), West is negative
        if using signed decimal degrees. For bearings, values in the range -π to +π [-180° to +180°]
        need to be converted to 0 to +2π [0°–360°]; this can  be done by (brng+2.π)%2.π [or
        brng+360)%360] where % is the (floating point) modulo operator (note that different languages
        implement the <a href="https://en.wikipedia.org/wiki/Modulo_operation">modulo operation</a>
        in different ways).</li>
    <li>All bearings are with respect to <b>true north</b>, 0°=N, 90°=E, etc; if you are working
        from a compass, magnetic north varies from true north in a complex way around the earth,
        and the difference has to be compensated for by variances indicated on local maps.</li>
    <li>The <b>atan2</b>() function widely used here takes two arguments, atan2(y, x), and computes
        the arc tangent of the ratio y/x. It is more flexible than atan(y/x), since it handles x=0,
        and it also returns values in all 4 quadrants -π to +π (the atan function returns values
        in the range -π/2 to +π/2).</li>
    <li>If you implement any formula involving atan2 in a spreadsheet (Microsoft <b>Excel</b>,
        LibreOffice Calc, Google Sheets, Apple Numbers), you will need to reverse  the arguments, as
        <a href="http://office.microsoft.com/en-gb/excel/HP052089911033.aspx">Excel</a> etc have them
        the opposite way around from <a href="https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Objects/Math/atan2">JavaScript</a>
        – conventional order is atan2(y, x), but Excel uses atan2(x, y). To use atan2 in a (VBA) macro,
        you can use WorksheetFunction.Atan2(). </li>
    <li>If you are using <b>Google Maps</b>, several of these functions are now provided in the Google
        Maps API V3 ‘spherical’ library (computeDistanceBetween(), computeHeading(), computeOffset(),
        interpolate(), etc; note they use a default Earth radius of 6,378,137 meters).</li>
    <li>If you use UK Ordnance Survey Grid References, I have implemented a script for
        <a href="http://www.movable-type.co.uk/scripts/latlong-os-gridref.html">converting between Lat/Long &amp; OS Grid References</a>.</li>
    <li>If you use UTM coordinates or MGRS grid references, I have implemented scripts for
        <a href="http://www.movable-type.co.uk/scripts/latlong-utm-mgrs.html">converting between Lat/Long, UTM, &amp; MGRS</a>.</li>
    <li>I learned a lot from the US Census Bureau <a href="http://www.movable-type.co.uk/scripts/gis-faq-5.1.html">GIS FAQ</a> which is no
        longer available, so I’ve made a copy.</li>
    <li>Thanks to Ed Williams’ <a href="http://www.edwilliams.org/avform.htm">Aviation Formulary</a>
        for many of the formulas.</li>
    <li>For <b>miles</b>, divide km by 1.609344</li>
    <li>For <b>nautical miles</b>, divide km by 1.852</li>
</ul>

<hr class="fullwidth">

<p id="postscript">See below for the JavaScript source code,
    also available on <a href="https://github.com/chrisveness/geodesy">GitHub</a>. Full
    <a href="http://www.movable-type.co.uk/scripts/geodesy-library.html">documentation</a> is available, as well as a
    <a href="http://www.movable-type.co.uk/scripts/test/geodesy-test.html">test suite</a>.</p>
<p>Note I use Greek letters in variables representing maths symbols conventionally presented as Greek letters:
    I value the great benefit in legibility over the minor inconvenience in typing (if you
    encounter any problems, ensure your <code>&lt;head&gt;</code> includes <code>&lt;meta charset="utf-8"&gt;</code>),
    and use UTF-8 encoding when saving files).</p>
<p>With its untyped C-style syntax, JavaScript reads remarkably close to pseudo-code: exposing the
    algorithms with a minimum of syntactic distractions. These functions should be simple to
    translate into other languages if required, though can also be used as-is in browsers and Node.js.</p>
<p>I have extended the base JavaScript Number object with toRadians() and toDegrees() methods:
    I don’t see great likelihood of conflicts, as these are ubiquitous operations.</p>
<p>I also have a page illustrating the use of the spherical law of cosines for <a href="http://www.movable-type.co.uk/scripts/latlong-db.html">selecting
    points from a database</a> within a specified bounding circle – the example is based on MySQL+PDO,
    but should be extensible to other DBMS platforms.</p>
<p id="spreadsheets">Several people have asked about example <b>Excel</b> spreadsheets, so I have implemented the
    <a href="http://www.movable-type.co.uk/scripts/latlong-distance+bearing.xls">distance &amp; bearing</a> and the <a href="http://www.movable-type.co.uk/scripts/latlong-dest-point.xls">destination
    point</a> formulas as spreadsheets, in a form which breaks down the all stages involved to illustrate
    the operation.</p>
<p><i>February 2019</i>: I have refactored the library to use ES modules, as well as extending it in
    scope; see the <a href="https://github.com/chrisveness/geodesy">GitHub</a> README and CHANGELOG for details.</p>
<p>Performance: as noted above, the haversine distance calculation takes around
    <a href="http://www.movable-type.co.uk/scripts/performance/latlong-spherical.html">2 – 5 micro­seconds</a> (hence around 200,000 –
    500,000 per second). I have yet to complete timing tests on other calculations.</p>
<p id="other-languages"><b>Other languages</b>: I cannot support translations into other languages, but if you have ported
    the code to another language, I am happy to provide links here.</p>
<ul>
    <li>Brian Lambert has made an <a href="https://github.com/softwarenerd/GreatCircle">Objective-C</a> version.</li>
    <li>Jean Brouwers has made a <a href="https://github.com/mrJean1/PyGeodesy">Python</a> version.</li>
    <li>Vahan Aghajanyan has made a <a href="https://github.com/vahancho/erkir">C++</a> version.</li>
</ul>
<p id="licence"><a href="http://opensource.org/licenses/MIT" class="float-right"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/license-osi-mit.png" alt="OSI MIT License"></a>
    I offer these scripts for free use and adaptation to balance my debt to the open-source info-verse.
    You are welcome to re-use these scripts [under an <a href="http://opensource.org/licenses/MIT">MIT</a> licence,
    without any warranty express or implied] provided solely that you retain my copyright notice and a link to this page.</p>
<p id="donate"><a href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&amp;hosted_button_id=3737803" class="float-right">
        <img alt="Paypal donation" style="margin:4px" src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/btn_donate_SM.gif"></a>
    If you would like to show your appreciation and support continued development of these scripts,
    I would most gratefully accept <a href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&amp;hosted_button_id=3737803" title="Thank you!">donations</a>.</p>
<p>If you need any advice or development work done, I am available for consultancy.</p>
<p>If you have any queries or find any problems, contact me at <span class="rtl">ku.oc.epyt-elbavom@oeg-stpircs</span>.</p>
<p class="note"><i>© 2002-2019 Chris Veness</i></p>

</main>

<hr class="fullwidth">
<pre class="fullwidth code prettyprint" id="latlon-src"><span class="com"><span class="com">/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */</span></span><span class="pln"><span class="pln">
</span></span><span class="com"><span class="com">/* Latitude/longitude spherical geodesy tools                         (c) Chris Veness 2002-2019  */</span></span><span class="pln"><span class="pln">
</span></span><span class="com"><span class="com">/*                                                                                   MIT Licence  */</span></span><span class="pln"><span class="pln">
</span></span><span class="com"><span class="com">/* www.movable-type.co.uk/scripts/latlong.html                                                    */</span></span><span class="pln"><span class="pln">
</span></span><span class="com"><span class="com">/* www.movable-type.co.uk/scripts/geodesy-library.html#latlon-spherical                           */</span></span><span class="pln"><span class="pln">
</span></span><span class="com"><span class="com">/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */</span></span><span class="pln"><span class="pln">

</span></span><span class="kwd"><span class="kwd">import</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">from</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'./dms.js'</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">

</span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">π</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">


</span></span><span class="com"><span class="com">/**
 * Library of geodesy functions for operations on a spherical earth model.
 *
 * Includes distances, bearings, destinations, etc, for both great circle paths and rhumb lines,
 * and other related functions.
 *
 * All calculations are done using simple spherical trigonometric formulae.
 *
 * @module latlon-spherical
 */</span></span><span class="pln"><span class="pln">

</span></span><span class="com"><span class="com">// note greek letters (e.g. φ, λ, θ) are used for angles in radians to distinguish from angles in</span></span><span class="pln"><span class="pln">
</span></span><span class="com"><span class="com">// degrees (e.g. lat, lon, brng)</span></span><span class="pln"><span class="pln">


</span></span><span class="com"><span class="com">/* LatLonSpherical - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */</span></span><span class="pln"><span class="pln">


</span></span><span class="com"><span class="com">/**
 * Latitude/longitude points on a spherical model earth, and methods for calculating distances,
 * bearings, destinations, etc on (orthodromic) great-circle paths and (loxodromic) rhumb lines.
 */</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">class</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">

    </span></span><span class="com"><span class="com">/**
     * Creates a latitude/longitude point on the earth’s surface, using a spherical model earth.
     *
     * @param  {number} lat - Latitude (in degrees).
     * @param  {number} lon - Longitude (in degrees).
     * @throws {TypeError} Invalid lat/lon.
     *
     * @example
     *   import LatLon from '/js/geodesy/latlon-spherical.js';
     *   const p = new LatLon(52.205, 0.119);
     */</span></span><span class="pln"><span class="pln">
    constructor</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> lon</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">isNaN</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">throw</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">TypeError</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">`invalid lat ‘${lat}’`</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">isNaN</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">throw</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">TypeError</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">`invalid lon ‘${lon}’`</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">_lat </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">wrap90</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">_lon </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">wrap180</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">


    </span></span><span class="com"><span class="com">/**
     * Latitude in degrees north from equator (including aliases lat, latitude): can be set as
     * numeric or hexagesimal (deg-min-sec); returned as numeric.
     */</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">get</span></span><span class="pln"><span class="pln"> lat</span></span><span class="pun"><span class="pun">()</span></span><span class="pln"><span class="pln">       </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">_lat</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">get</span></span><span class="pln"><span class="pln"> latitude</span></span><span class="pun"><span class="pun">()</span></span><span class="pln"><span class="pln">  </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">_lat</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">set</span></span><span class="pln"><span class="pln"> lat</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">_lat </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> isNaN</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">?</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">wrap90</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">parse</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">wrap90</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">isNaN</span></span><span class="pun"><span class="pun">(</span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">_lat</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">throw</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">TypeError</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">`invalid lat ‘${lat}’`</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">set</span></span><span class="pln"><span class="pln"> latitude</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">_lat </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> isNaN</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">?</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">wrap90</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">parse</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">wrap90</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">isNaN</span></span><span class="pun"><span class="pun">(</span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">_lat</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">throw</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">TypeError</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">`invalid latitude ‘${lat}’`</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">

    </span></span><span class="com"><span class="com">/**
     * Longitude in degrees east from international reference meridian (including aliases lon, lng,
     * longitude): can be set as numeric or hexagesimal (deg-min-sec); returned as numeric.
     */</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">get</span></span><span class="pln"><span class="pln"> lon</span></span><span class="pun"><span class="pun">()</span></span><span class="pln"><span class="pln">       </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">_lon</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">get</span></span><span class="pln"><span class="pln"> lng</span></span><span class="pun"><span class="pun">()</span></span><span class="pln"><span class="pln">       </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">_lon</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">get</span></span><span class="pln"><span class="pln"> longitude</span></span><span class="pun"><span class="pun">()</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">_lon</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">set</span></span><span class="pln"><span class="pln"> lon</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">_lon </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> isNaN</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">?</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">wrap180</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">parse</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">wrap180</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">isNaN</span></span><span class="pun"><span class="pun">(</span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">_lon</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">throw</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">TypeError</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">`invalid lon ‘${lon}’`</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">set</span></span><span class="pln"><span class="pln"> lng</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">_lon </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> isNaN</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">?</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">wrap180</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">parse</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">wrap180</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">isNaN</span></span><span class="pun"><span class="pun">(</span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">_lon</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">throw</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">TypeError</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">`invalid lng ‘${lon}’`</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">set</span></span><span class="pln"><span class="pln"> longitude</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">_lon </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> isNaN</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">?</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">wrap180</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">parse</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">wrap180</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">isNaN</span></span><span class="pun"><span class="pun">(</span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">_lon</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">throw</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">TypeError</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">`invalid longitude ‘${lon}’`</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">


    </span></span><span class="com"><span class="com">/** Conversion factors; 1000 * LatLon.metresToKm gives 1. */</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">static</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">get</span></span><span class="pln"><span class="pln"> metresToKm</span></span><span class="pun"><span class="pun">()</span></span><span class="pln"><span class="pln">            </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">1000</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">
    </span></span><span class="com"><span class="com">/** Conversion factors; 1000 * LatLon.metresToMiles gives 0.621371192237334. */</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">static</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">get</span></span><span class="pln"><span class="pln"> metresToMiles</span></span><span class="pun"><span class="pun">()</span></span><span class="pln"><span class="pln">         </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">1609.344</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">
    </span></span><span class="com"><span class="com">/** Conversion factors; 1000 * LatLon.metresToMiles gives 0.5399568034557236. */</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">static</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">get</span></span><span class="pln"><span class="pln"> metresToNauticalMiles</span></span><span class="pun"><span class="pun">()</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">1852</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">


    </span></span><span class="com"><span class="com">/**
     * Parses a latitude/longitude point from a variety of formats.
     *
     * Latitude &amp; longitude (in degrees) can be supplied as two separate parameters, as a single
     * comma-separated lat/lon string, or as a single object with { lat, lon } or GeoJSON properties.
     *
     * The latitude/longitude values may be numeric or strings; they may be signed decimal or
     * deg-min-sec (hexagesimal) suffixed by compass direction (NSEW); a variety of separators are
     * accepted. Examples -3.62, '3 37 12W', '3°37′12″W'.
     *
     * Thousands/decimal separators must be comma/dot; use Dms.fromLocale to convert locale-specific
     * thousands/decimal separators.
     *
     * @param   {number|string|Object} lat|latlon - Latitude (in degrees) or comma-separated lat/lon or lat/lon object.
     * @param   {number|string}        [lon]      - Longitude (in degrees).
     * @returns {LatLon} Latitude/longitude point.
     * @throws  {TypeError} Invalid point.
     *
     * @example
     *   const p1 = LatLon.parse(52.205, 0.119);                                    // numeric pair (≡ new LatLon)
     *   const p2 = LatLon.parse('52.205', '0.119');                                // numeric string pair (≡ new LatLon)
     *   const p3 = LatLon.parse('52.205, 0.119');                                  // single string numerics
     *   const p4 = LatLon.parse('52°12′18.0″N', '000°07′08.4″E');                  // DMS pair
     *   const p5 = LatLon.parse('52°12′18.0″N, 000°07′08.4″E');                    // single string DMS
     *   const p6 = LatLon.parse({ lat: 52.205, lon: 0.119 });                      // { lat, lon } object numeric
     *   const p7 = LatLon.parse({ lat: '52°12′18.0″N', lng: '000°07′08.4″E' });    // { lat, lng } object DMS
     *   const p8 = LatLon.parse({ type: 'Point', coordinates: [ 0.119, 52.205] }); // GeoJSON
     */</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">static</span></span><span class="pln"><span class="pln"> parse</span></span><span class="pun"><span class="pun">(...</span></span><span class="pln"><span class="pln">args</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">args</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">length </span></span><span class="pun"><span class="pun">==</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">throw</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">TypeError</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">'invalid (empty) point'</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">args</span></span><span class="pun"><span class="pun">[</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">]===</span></span><span class="kwd"><span class="kwd">null</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">||</span></span><span class="pln"><span class="pln"> args</span></span><span class="pun"><span class="pun">[</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">]===</span></span><span class="kwd"><span class="kwd">null</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">throw</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">TypeError</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">'invalid (null) point'</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">

        let lat</span></span><span class="pun"><span class="pun">=</span></span><span class="kwd"><span class="kwd">undefined</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> lon</span></span><span class="pun"><span class="pun">=</span></span><span class="kwd"><span class="kwd">undefined</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">args</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">length </span></span><span class="pun"><span class="pun">==</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// regular (lat, lon) arguments</span></span><span class="pln"><span class="pln">
            </span></span><span class="pun"><span class="pun">[</span></span><span class="pln"><span class="pln"> lat</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> lon </span></span><span class="pun"><span class="pun">]</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> args</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
            lat </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">wrap90</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">parse</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln">
            lon </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">wrap180</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">parse</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln">
            </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">isNaN</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">||</span></span><span class="pln"><span class="pln"> isNaN</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">throw</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">TypeError</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">`invalid point ‘${args.toString()}’`</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
        </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">args</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">length </span></span><span class="pun"><span class="pun">==</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&amp;&amp;</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">typeof</span></span><span class="pln"><span class="pln"> args</span></span><span class="pun"><span class="pun">[</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">]</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">==</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'string'</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// single comma-separated lat,lon string</span></span><span class="pln"><span class="pln">
            </span></span><span class="pun"><span class="pun">[</span></span><span class="pln"><span class="pln"> lat</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> lon </span></span><span class="pun"><span class="pun">]</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> args</span></span><span class="pun"><span class="pun">[</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">].</span></span><span class="pln"><span class="pln">split</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">','</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
            lat </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">wrap90</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">parse</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln">
            lon </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">wrap180</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">parse</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln">
            </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">isNaN</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">||</span></span><span class="pln"><span class="pln"> isNaN</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">throw</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">TypeError</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">`invalid point ‘${args[0]}’`</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
        </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">args</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">length </span></span><span class="pun"><span class="pun">==</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&amp;&amp;</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">typeof</span></span><span class="pln"><span class="pln"> args</span></span><span class="pun"><span class="pun">[</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">]</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">==</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'object'</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// single { lat, lon } object</span></span><span class="pln"><span class="pln">
            </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> ll </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> args</span></span><span class="pun"><span class="pun">[</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">];</span></span><span class="pln"><span class="pln">
            </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">ll</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">type </span></span><span class="pun"><span class="pun">==</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'Point'</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&amp;&amp;</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Array</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">isArray</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">ll</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">coordinates</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// GeoJSON</span></span><span class="pln"><span class="pln">
                </span></span><span class="pun"><span class="pun">[</span></span><span class="pln"><span class="pln"> lon</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> lat </span></span><span class="pun"><span class="pun">]</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> ll</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">coordinates</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
            </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">else</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// regular { lat, lon } object</span></span><span class="pln"><span class="pln">
                </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">ll</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">latitude  </span></span><span class="pun"><span class="pun">!=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">undefined</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> lat </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> ll</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">latitude</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
                </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">ll</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat       </span></span><span class="pun"><span class="pun">!=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">undefined</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> lat </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> ll</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
                </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">ll</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">longitude </span></span><span class="pun"><span class="pun">!=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">undefined</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> lon </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> ll</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">longitude</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
                </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">ll</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lng       </span></span><span class="pun"><span class="pun">!=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">undefined</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> lon </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> ll</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lng</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
                </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">ll</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon       </span></span><span class="pun"><span class="pun">!=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">undefined</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> lon </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> ll</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
                lat </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">wrap90</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">parse</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln">
                lon </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">wrap180</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">parse</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln">
            </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">
            </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">isNaN</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">||</span></span><span class="pln"><span class="pln"> isNaN</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">throw</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">TypeError</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">`invalid point ‘${JSON.stringify(args[0])}’`</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
        </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">isNaN</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">||</span></span><span class="pln"><span class="pln"> isNaN</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">throw</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">TypeError</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">`invalid point ‘${args.toString()}’`</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> lon</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">


    </span></span><span class="com"><span class="com">/**
     * Returns the distance along the surface of the earth from ‘this’ point to destination point.
     *
     * Uses haversine formula: a = sin²(Δφ/2) + cosφ1·cosφ2 · sin²(Δλ/2); d = 2 · atan2(√a, √(a-1)).
     *
     * @param   {LatLon} point - Latitude/longitude of destination point.
     * @param   {number} [radius=6371e3] - Radius of earth (defaults to mean radius in metres).
     * @returns {number} Distance between this point and destination point, in same units as radius.
     * @throws  {TypeError} Invalid radius.
     *
     * @example
     *   const p1 = new LatLon(52.205, 0.119);
     *   const p2 = new LatLon(48.857, 2.351);
     *   const d = p1.distanceTo(p2);       // 404.3×10³ m
     *   const m = p1.distanceTo(p2, 3959); // 251.2 miles
     */</span></span><span class="pln"><span class="pln">
    distanceTo</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> radius</span></span><span class="pun"><span class="pun">=</span></span><span class="lit"><span class="lit">6371e3</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(!(</span></span><span class="pln"><span class="pln">point </span></span><span class="kwd"><span class="kwd">instanceof</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> point </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">parse</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// allow literal forms</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">isNaN</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">radius</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">throw</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">TypeError</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">`invalid radius ‘${radius}’`</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">

        </span></span><span class="com"><span class="com">// a = sin²(Δφ/2) + cos(φ1)⋅cos(φ2)⋅sin²(Δλ/2)</span></span><span class="pln"><span class="pln">
        </span></span><span class="com"><span class="com">// δ = 2·atan2(√(a), √(1−a))</span></span><span class="pln"><span class="pln">
        </span></span><span class="com"><span class="com">// see mathforum.org/library/drmath/view/51879.html for derivation</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> R </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> radius</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">(),</span></span><span class="pln"><span class="pln">  </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> point</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">(),</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> point</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δφ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> a </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(Δφ/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(Δφ/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(Δλ/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(Δλ/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> c </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">atan2</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sqrt</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">a</span></span><span class="pun"><span class="pun">),</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sqrt</span></span><span class="pun"><span class="pun">(</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln">a</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> d </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> R </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> c</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> d</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">


    </span></span><span class="com"><span class="com">/**
     * Returns the initial bearing from ‘this’ point to destination point.
     *
     * @param   {LatLon} point - Latitude/longitude of destination point.
     * @returns {number} Initial bearing in degrees from north (0°..360°).
     *
     * @example
     *   const p1 = new LatLon(52.205, 0.119);
     *   const p2 = new LatLon(48.857, 2.351);
     *   const b1 = p1.initialBearingTo(p2); // 156.2°
     */</span></span><span class="pln"><span class="pln">
    initialBearingTo</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(!(</span></span><span class="pln"><span class="pln">point </span></span><span class="kwd"><span class="kwd">instanceof</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> point </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">parse</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// allow literal forms</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">equals</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">NaN</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// coincident points</span></span><span class="pln"><span class="pln">

        </span></span><span class="com"><span class="com">// tanθ = sinΔλ⋅cosφ2 / cosφ1⋅sinφ2 − sinφ1⋅cosφ2⋅cosΔλ</span></span><span class="pln"><span class="pln">
        </span></span><span class="com"><span class="com">// see mathforum.org/library/drmath/view/55417.html for derivation</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> point</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> x </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(Δλ);</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> y </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(Δλ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">atan2</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">y</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> x</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> bearing </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ.</span></span><span class="pln"><span class="pln">toDegrees</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">wrap360</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">bearing</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">


    </span></span><span class="com"><span class="com">/**
     * Returns final bearing arriving at destination point from ‘this’ point; the final bearing will
     * differ from the initial bearing by varying degrees according to distance and latitude.
     *
     * @param   {LatLon} point - Latitude/longitude of destination point.
     * @returns {number} Final bearing in degrees from north (0°..360°).
     *
     * @example
     *   const p1 = new LatLon(52.205, 0.119);
     *   const p2 = new LatLon(48.857, 2.351);
     *   const b2 = p1.finalBearingTo(p2); // 157.9°
     */</span></span><span class="pln"><span class="pln">
    finalBearingTo</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(!(</span></span><span class="pln"><span class="pln">point </span></span><span class="kwd"><span class="kwd">instanceof</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> point </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">parse</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// allow literal forms</span></span><span class="pln"><span class="pln">

        </span></span><span class="com"><span class="com">// get initial bearing from destination point to this point &amp; reverse it by adding 180°</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> bearing </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> point</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">initialBearingTo</span></span><span class="pun"><span class="pun">(</span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">180</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">wrap360</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">bearing</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">


    </span></span><span class="com"><span class="com">/**
     * Returns the midpoint between ‘this’ point and destination point.
     *
     * @param   {LatLon} point - Latitude/longitude of destination point.
     * @returns {LatLon} Midpoint between this point and destination point.
     *
     * @example
     *   const p1 = new LatLon(52.205, 0.119);
     *   const p2 = new LatLon(48.857, 2.351);
     *   const pMid = p1.midpointTo(p2); // 50.5363°N, 001.2746°E
     */</span></span><span class="pln"><span class="pln">
    midpointTo</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(!(</span></span><span class="pln"><span class="pln">point </span></span><span class="kwd"><span class="kwd">instanceof</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> point </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">parse</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// allow literal forms</span></span><span class="pln"><span class="pln">

        </span></span><span class="com"><span class="com">// φm = atan2( sinφ1 + sinφ2, √( (cosφ1 + cosφ2⋅cosΔλ)² + cos²φ2⋅sin²Δλ ) )</span></span><span class="pln"><span class="pln">
        </span></span><span class="com"><span class="com">// λm = λ1 + atan2(cosφ2⋅sinΔλ, cosφ1 + cosφ2⋅cosΔλ)</span></span><span class="pln"><span class="pln">
        </span></span><span class="com"><span class="com">// midpoint is sum of vectors to two points: mathforum.org/library/drmath/view/51822.html</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> point</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">

        </span></span><span class="com"><span class="com">// get cartesian coordinates for the two points</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> A </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln"> x</span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">),</span></span><span class="pln"><span class="pln"> y</span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> z</span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">};</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// place point A on prime meridian y=0</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> B </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln"> x</span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(Δλ),</span></span><span class="pln"><span class="pln"> y</span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(Δλ),</span></span><span class="pln"><span class="pln"> z</span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">};</span></span><span class="pln"><span class="pln">

        </span></span><span class="com"><span class="com">// vector to midpoint is sum of vectors to two points (no need to normalise)</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> C </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln"> x</span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> A</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">x </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> B</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">x</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> y</span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> A</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">y </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> B</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">y</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> z</span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> A</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">z </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> B</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">z </span></span><span class="pun"><span class="pun">};</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="pln"><span class="pln">m </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">atan2</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">C</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">z</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sqrt</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">C</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">x</span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln">C</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">x </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> C</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">y</span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln">C</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">y</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="pln"><span class="pln">m </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">atan2</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">C</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">y</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> C</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">x</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> lat </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="pln"><span class="pln">m</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toDegrees</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> lon </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="pln"><span class="pln">m</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toDegrees</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> lon</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">


    </span></span><span class="com"><span class="com">/**
     * Returns the point at given fraction between ‘this’ point and given point.
     *
     * @param   {LatLon} point - Latitude/longitude of destination point.
     * @param   {number} fraction - Fraction between the two points (0 = this point, 1 = specified point).
     * @returns {LatLon} Intermediate point between this point and destination point.
     *
     * @example
     *   const p1 = new LatLon(52.205, 0.119);
     *   const p2 = new LatLon(48.857, 2.351);
     *   const pInt = p1.intermediatePointTo(p2, 0.25); // 51.3721°N, 000.7073°E
     */</span></span><span class="pln"><span class="pln">
    intermediatePointTo</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> fraction</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(!(</span></span><span class="pln"><span class="pln">point </span></span><span class="kwd"><span class="kwd">instanceof</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> point </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">parse</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// allow literal forms</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">equals</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">(</span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// coincident points</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">(),</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> point</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">(),</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> point</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">

        </span></span><span class="com"><span class="com">// distance between points</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δφ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> a </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(Δφ/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(Δφ/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln">
            </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(Δλ/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(Δλ/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">δ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">atan2</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sqrt</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">a</span></span><span class="pun"><span class="pun">),</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sqrt</span></span><span class="pun"><span class="pun">(</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln">a</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> A </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">((</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln">fraction</span></span><span class="pun"><span class="pun">)*δ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(δ);</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> B </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">fraction</span></span><span class="pun"><span class="pun">*δ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(δ);</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> x </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> A </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> B </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> y </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> A </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> B </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> z </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> A </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> B </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">3</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">atan2</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">z</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sqrt</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">x</span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln">x </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> y</span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln">y</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">3</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">atan2</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">y</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> x</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> lat </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">3.toDegrees</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> lon </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">3.toDegrees</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> lon</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">


    </span></span><span class="com"><span class="com">/**
     * Returns the destination point from ‘this’ point having travelled the given distance on the
     * given initial bearing (bearing normally varies around path followed).
     *
     * @param   {number} distance - Distance travelled, in same units as earth radius (default: metres).
     * @param   {number} bearing - Initial bearing in degrees from north.
     * @param   {number} [radius=6371e3] - (Mean) radius of earth (defaults to radius in metres).
     * @returns {LatLon} Destination point.
     *
     * @example
     *   const p1 = new LatLon(51.47788, -0.00147);
     *   const p2 = p1.destinationPoint(7794, 300.7); // 51.5136°N, 000.0983°W
     */</span></span><span class="pln"><span class="pln">
    destinationPoint</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">distance</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> bearing</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> radius</span></span><span class="pun"><span class="pun">=</span></span><span class="lit"><span class="lit">6371e3</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="com"><span class="com">// sinφ2 = sinφ1⋅cosδ + cosφ1⋅sinδ⋅cosθ</span></span><span class="pln"><span class="pln">
        </span></span><span class="com"><span class="com">// tanΔλ = sinθ⋅sinδ⋅cosφ1 / cosδ−sinφ1⋅sinφ2</span></span><span class="pln"><span class="pln">
        </span></span><span class="com"><span class="com">// see mathforum.org/library/drmath/view/52049.html for derivation</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">δ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> distance </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> radius</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// angular distance in radians</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Number</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">bearing</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">(),</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> sin</span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(δ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(δ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(θ);</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">asin</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> y </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(θ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(δ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> x </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(δ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> sin</span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">atan2</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">y</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> x</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> lat </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2.toDegrees</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> lon </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">2.toDegrees</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> lon</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">


    </span></span><span class="com"><span class="com">/**
     * Returns the point of intersection of two paths defined by point and bearing.
     *
     * @param   {LatLon}      p1 - First point.
     * @param   {number}      brng1 - Initial bearing from first point.
     * @param   {LatLon}      p2 - Second point.
     * @param   {number}      brng2 - Initial bearing from second point.
     * @returns {LatLon|null} Destination point (null if no unique intersection defined).
     *
     * @example
     *   const p1 = new LatLon(51.8853, 0.2545), brng1 = 108.547;
     *   const p2 = new LatLon(49.0034, 2.5735), brng2 =  32.435;
     *   const pInt = LatLon.intersection(p1, brng1, p2, brng2); // 50.9078°N, 004.5084°E
     */</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">static</span></span><span class="pln"><span class="pln"> intersection</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">p1</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> brng1</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> p2</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> brng2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(!(</span></span><span class="pln"><span class="pln">p1 </span></span><span class="kwd"><span class="kwd">instanceof</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> p1 </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">parse</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">p1</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// allow literal forms</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(!(</span></span><span class="pln"><span class="pln">p2 </span></span><span class="kwd"><span class="kwd">instanceof</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> p2 </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">parse</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">p2</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// allow literal forms</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">isNaN</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">brng1</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">throw</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">TypeError</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">`invalid brng1 ‘${brng1}’`</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">isNaN</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">brng2</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">throw</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">TypeError</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">`invalid brng2 ‘${brng2}’`</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">

        </span></span><span class="com"><span class="com">// see www.edwilliams.org/avform.htm#Intersection</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> p1</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">(),</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> p1</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> p2</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">(),</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> p2</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="lit"><span class="lit">13</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Number</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">brng1</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">(),</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="lit"><span class="lit">23</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Number</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">brng2</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δφ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">

        </span></span><span class="com"><span class="com">// angular distance p1-p2</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">δ</span></span><span class="lit"><span class="lit">12</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">asin</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sqrt</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(Δφ/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(Δφ/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln">
            </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(Δλ/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(Δλ/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)));</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">abs</span></span><span class="pun"><span class="pun">(δ</span></span><span class="lit"><span class="lit">12</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&lt;</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Number</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">EPSILON</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">p1</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> p1</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// coincident points</span></span><span class="pln"><span class="pln">

        </span></span><span class="com"><span class="com">// initial/final bearings between points</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> cos</span></span><span class="pun"><span class="pun">θ</span></span><span class="pln"><span class="pln">a </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(δ</span></span><span class="lit"><span class="lit">12</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(δ</span></span><span class="lit"><span class="lit">12</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> cos</span></span><span class="pun"><span class="pun">θ</span></span><span class="pln"><span class="pln">b </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(δ</span></span><span class="lit"><span class="lit">12</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(δ</span></span><span class="lit"><span class="lit">12</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="pln"><span class="pln">a </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">acos</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">min</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">max</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">θ</span></span><span class="pln"><span class="pln">a</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">),</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// protect against rounding errors</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="pln"><span class="pln">b </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">acos</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">min</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">max</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">θ</span></span><span class="pln"><span class="pln">b</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">),</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// protect against rounding errors</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="lit"><span class="lit">12</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">-λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)&gt;</span></span><span class="lit"><span class="lit">0</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">?</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="pln"><span class="pln">a </span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">*π-θ</span></span><span class="pln"><span class="pln">a</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="lit"><span class="lit">21</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">-λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)&gt;</span></span><span class="lit"><span class="lit">0</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">?</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">*π-θ</span></span><span class="pln"><span class="pln">b </span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="pln"><span class="pln">b</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">α</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="lit"><span class="lit">13</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="lit"><span class="lit">12</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// angle 2-1-3</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">α</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="lit"><span class="lit">21</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="lit"><span class="lit">23</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// angle 1-2-3</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(α</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">==</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">0</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&amp;&amp;</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(α</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">==</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">null</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// infinite intersections</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(α</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(α</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&lt;</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">null</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">        </span></span><span class="com"><span class="com">// ambiguous intersection (antipodal?)</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> cos</span></span><span class="pun"><span class="pun">α</span></span><span class="lit"><span class="lit">3</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(α</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(α</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(α</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(α</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(δ</span></span><span class="lit"><span class="lit">12</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">δ</span></span><span class="lit"><span class="lit">13</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">atan2</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(δ</span></span><span class="lit"><span class="lit">12</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(α</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(α</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">),</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(α</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(α</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">α</span></span><span class="lit"><span class="lit">3</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">3</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">asin</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(δ</span></span><span class="lit"><span class="lit">13</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(δ</span></span><span class="lit"><span class="lit">13</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(θ</span></span><span class="lit"><span class="lit">13</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="lit"><span class="lit">13</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">atan2</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(θ</span></span><span class="lit"><span class="lit">13</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(δ</span></span><span class="lit"><span class="lit">13</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">),</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(δ</span></span><span class="lit"><span class="lit">13</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">3</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">3</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="lit"><span class="lit">13</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> lat </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">3.toDegrees</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> lon </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">3.toDegrees</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> lon</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">


    </span></span><span class="com"><span class="com">/**
     * Returns (signed) distance from ‘this’ point to great circle defined by start-point and
     * end-point.
     *
     * @param   {LatLon} pathStart - Start point of great circle path.
     * @param   {LatLon} pathEnd - End point of great circle path.
     * @param   {number} [radius=6371e3] - (Mean) radius of earth (defaults to radius in metres).
     * @returns {number} Distance to great circle (-ve if to left, +ve if to right of path).
     *
     * @example
     *   const pCurrent = new LatLon(53.2611, -0.7972);
     *   const p1 = new LatLon(53.3206, -1.7297);
     *   const p2 = new LatLon(53.1887, 0.1334);
     *   const d = pCurrent.crossTrackDistanceTo(p1, p2);  // -307.5 m
     */</span></span><span class="pln"><span class="pln">
    crossTrackDistanceTo</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">pathStart</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> pathEnd</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> radius</span></span><span class="pun"><span class="pun">=</span></span><span class="lit"><span class="lit">6371e3</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(!(</span></span><span class="pln"><span class="pln">pathStart </span></span><span class="kwd"><span class="kwd">instanceof</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> pathStart </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">parse</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">pathStart</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// allow literal forms</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(!(</span></span><span class="pln"><span class="pln">pathEnd </span></span><span class="kwd"><span class="kwd">instanceof</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> pathEnd </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">parse</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">pathEnd</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">       </span></span><span class="com"><span class="com">// allow literal forms</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> R </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> radius</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">δ</span></span><span class="lit"><span class="lit">13</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> pathStart</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">distanceTo</span></span><span class="pun"><span class="pun">(</span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> R</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> R</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="lit"><span class="lit">13</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> pathStart</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">initialBearingTo</span></span><span class="pun"><span class="pun">(</span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="lit"><span class="lit">12</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> pathStart</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">initialBearingTo</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">pathEnd</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">δ</span></span><span class="pln"><span class="pln">xt </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">asin</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(δ</span></span><span class="lit"><span class="lit">13</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(θ</span></span><span class="lit"><span class="lit">13</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="lit"><span class="lit">12</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">δ</span></span><span class="pln"><span class="pln">xt </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> R</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">


    </span></span><span class="com"><span class="com">/**
     * Returns how far ‘this’ point is along a path from from start-point, heading towards end-point.
     * That is, if a perpendicular is drawn from ‘this’ point to the (great circle) path, the
     * along-track distance is the distance from the start point to where the perpendicular crosses
     * the path.
     *
     * @param   {LatLon} pathStart - Start point of great circle path.
     * @param   {LatLon} pathEnd - End point of great circle path.
     * @param   {number} [radius=6371e3] - (Mean) radius of earth (defaults to radius in metres).
     * @returns {number} Distance along great circle to point nearest ‘this’ point.
     *
     * @example
     *   const pCurrent = new LatLon(53.2611, -0.7972);
     *   const p1 = new LatLon(53.3206, -1.7297);
     *   const p2 = new LatLon(53.1887,  0.1334);
     *   const d = pCurrent.alongTrackDistanceTo(p1, p2);  // 62.331 km
     */</span></span><span class="pln"><span class="pln">
    alongTrackDistanceTo</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">pathStart</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> pathEnd</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> radius</span></span><span class="pun"><span class="pun">=</span></span><span class="lit"><span class="lit">6371e3</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(!(</span></span><span class="pln"><span class="pln">pathStart </span></span><span class="kwd"><span class="kwd">instanceof</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> pathStart </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">parse</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">pathStart</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// allow literal forms</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(!(</span></span><span class="pln"><span class="pln">pathEnd </span></span><span class="kwd"><span class="kwd">instanceof</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> pathEnd </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">parse</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">pathEnd</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">       </span></span><span class="com"><span class="com">// allow literal forms</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> R </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> radius</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">δ</span></span><span class="lit"><span class="lit">13</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> pathStart</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">distanceTo</span></span><span class="pun"><span class="pun">(</span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> R</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> R</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="lit"><span class="lit">13</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> pathStart</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">initialBearingTo</span></span><span class="pun"><span class="pun">(</span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="lit"><span class="lit">12</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> pathStart</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">initialBearingTo</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">pathEnd</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">δ</span></span><span class="pln"><span class="pln">xt </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">asin</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(δ</span></span><span class="lit"><span class="lit">13</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(θ</span></span><span class="lit"><span class="lit">13</span></span><span class="pun"><span class="pun">-θ</span></span><span class="lit"><span class="lit">12</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">δ</span></span><span class="pln"><span class="pln">at </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">acos</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(δ</span></span><span class="lit"><span class="lit">13</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">abs</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(δ</span></span><span class="pln"><span class="pln">xt</span></span><span class="pun"><span class="pun">)));</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">δ</span></span><span class="pln"><span class="pln">at</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sign</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(θ</span></span><span class="lit"><span class="lit">12</span></span><span class="pun"><span class="pun">-θ</span></span><span class="lit"><span class="lit">13</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> R</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">


    </span></span><span class="com"><span class="com">/**
     * Returns maximum latitude reached when travelling on a great circle on given bearing from
     * ‘this’ point (‘Clairaut’s formula’). Negate the result for the minimum latitude (in the
     * southern hemisphere).
     *
     * The maximum latitude is independent of longitude; it will be the same for all points on a
     * given latitude.
     *
     * @param   {number} bearing - Initial bearing.
     * @returns {number} Maximum latitude reached.
     */</span></span><span class="pln"><span class="pln">
    maxLatitude</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">bearing</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Number</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">bearing</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="typ"><span class="typ">Max</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">acos</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">abs</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(θ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ)));</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="typ"><span class="typ">Max</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toDegrees</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">


    </span></span><span class="com"><span class="com">/**
     * Returns the pair of meridians at which a great circle defined by two points crosses the given
     * latitude. If the great circle doesn't reach the given latitude, null is returned.
     *
     * @param   {LatLon}      point1 - First point defining great circle.
     * @param   {LatLon}      point2 - Second point defining great circle.
     * @param   {number}      latitude - Latitude crossings are to be determined for.
     * @returns {Object|null} Object containing { lon1, lon2 } or null if given latitude not reached.
     */</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">static</span></span><span class="pln"><span class="pln"> crossingParallels</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point1</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> point2</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> latitude</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point1</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">equals</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point2</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">null</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// coincident points</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Number</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">latitude</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> point1</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> point1</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> point2</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> point2</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> x </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(Δλ);</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> y </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(Δλ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ);</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> z </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(Δλ);</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">z </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> z </span></span><span class="pun"><span class="pun">&gt;</span></span><span class="pln"><span class="pln"> x </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> x </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> y </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> y</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">null</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// great circle doesn't reach latitude</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="pln"><span class="pln">m </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">atan2</span></span><span class="pun"><span class="pun">(-</span></span><span class="pln"><span class="pln">y</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> x</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">               </span></span><span class="com"><span class="com">// longitude at max latitude</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="pln"><span class="pln">i </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">acos</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">z </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sqrt</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">x</span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln">x </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> y</span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln">y</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// Δλ from λm to intersection points</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="pln"><span class="pln">i1 </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="pln"><span class="pln">m </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="pln"><span class="pln">i</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="pln"><span class="pln">i2 </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="pln"><span class="pln">m </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="pln"><span class="pln">i</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> lon1 </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="pln"><span class="pln">i1</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toDegrees</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> lon2 </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="pln"><span class="pln">i2</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toDegrees</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
            lon1</span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">wrap180</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lon1</span></span><span class="pun"><span class="pun">),</span></span><span class="pln"><span class="pln">
            lon2</span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">wrap180</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lon2</span></span><span class="pun"><span class="pun">),</span></span><span class="pln"><span class="pln">
        </span></span><span class="pun"><span class="pun">};</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">


    </span></span><span class="com"><span class="com">/* Rhumb - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */</span></span><span class="pln"><span class="pln">


    </span></span><span class="com"><span class="com">/**
     * Returns the distance travelling from ‘this’ point to destination point along a rhumb line.
     *
     * @param   {LatLon} point - Latitude/longitude of destination point.
     * @param   {number} [radius=6371e3] - (Mean) radius of earth (defaults to radius in metres).
     * @returns {number} Distance in km between this point and destination point (same units as radius).
     *
     * @example
     *   const p1 = new LatLon(51.127, 1.338);
     *   const p2 = new LatLon(50.964, 1.853);
     *   const d = p1.distanceTo(p2); //  40.31 km
     */</span></span><span class="pln"><span class="pln">
    rhumbDistanceTo</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> radius</span></span><span class="pun"><span class="pun">=</span></span><span class="lit"><span class="lit">6371e3</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(!(</span></span><span class="pln"><span class="pln">point </span></span><span class="kwd"><span class="kwd">instanceof</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> point </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">parse</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// allow literal forms</span></span><span class="pln"><span class="pln">

        </span></span><span class="com"><span class="com">// see www.edwilliams.org/avform.htm#Rhumb</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> R </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> radius</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> point</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δφ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
        let </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">abs</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
        </span></span><span class="com"><span class="com">// if dLon over 180° take shorter rhumb line across the anti-meridian:</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">abs</span></span><span class="pun"><span class="pun">(Δλ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&gt;</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">π)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&gt;</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">0</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">?</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-(</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">π</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">π</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ);</span></span><span class="pln"><span class="pln">

        </span></span><span class="com"><span class="com">// on Mercator projection, longitude distances shrink by latitude; q is the 'stretch factor'</span></span><span class="pln"><span class="pln">
        </span></span><span class="com"><span class="com">// q becomes ill-conditioned along E-W line (0/0); use empirical tolerance to avoid it</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δψ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">log</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">π</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">4</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">π</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">4</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> q </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">abs</span></span><span class="pun"><span class="pun">(Δψ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&gt;</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">10e-12</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">?</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δφ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δψ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">

        </span></span><span class="com"><span class="com">// distance is pythagoras on 'stretched' Mercator projection, √(Δφ² + q²·Δλ²)</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">δ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sqrt</span></span><span class="pun"><span class="pun">(Δφ*Δφ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> q</span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln">q </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ*Δλ);</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// angular distance in radians</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> d </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">δ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> R</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> d</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">


    </span></span><span class="com"><span class="com">/**
     * Returns the bearing from ‘this’ point to destination point along a rhumb line.
     *
     * @param   {LatLon}    point - Latitude/longitude of destination point.
     * @returns {number}    Bearing in degrees from north.
     *
     * @example
     *   const p1 = new LatLon(51.127, 1.338);
     *   const p2 = new LatLon(50.964, 1.853);
     *   const d = p1.rhumbBearingTo(p2); // 116.7°
     */</span></span><span class="pln"><span class="pln">
    rhumbBearingTo</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(!(</span></span><span class="pln"><span class="pln">point </span></span><span class="kwd"><span class="kwd">instanceof</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> point </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">parse</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// allow literal forms</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">equals</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">NaN</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// coincident points</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> point</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
        let </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
        </span></span><span class="com"><span class="com">// if dLon over 180° take shorter rhumb line across the anti-meridian:</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">abs</span></span><span class="pun"><span class="pun">(Δλ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&gt;</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">π)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&gt;</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">0</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">?</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-(</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">π</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">π</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ);</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δψ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">log</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">π</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">4</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">π</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">4</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">atan2</span></span><span class="pun"><span class="pun">(Δλ,</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δψ);</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> bearing </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ.</span></span><span class="pln"><span class="pln">toDegrees</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">wrap360</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">bearing</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">


    </span></span><span class="com"><span class="com">/**
     * Returns the destination point having travelled along a rhumb line from ‘this’ point the given
     * distance on the given bearing.
     *
     * @param   {number} distance - Distance travelled, in same units as earth radius (default: metres).
     * @param   {number} bearing - Bearing in degrees from north.
     * @param   {number} [radius=6371e3] - (Mean) radius of earth (defaults to radius in metres).
     * @returns {LatLon} Destination point.
     *
     * @example
     *   const p1 = new LatLon(51.127, 1.338);
     *   const p2 = p1.rhumbDestinationPoint(40300, 116.7); // 50.9642°N, 001.8530°E
     */</span></span><span class="pln"><span class="pln">
    rhumbDestinationPoint</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">distance</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> bearing</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> radius</span></span><span class="pun"><span class="pun">=</span></span><span class="lit"><span class="lit">6371e3</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">(),</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Number</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">bearing</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">δ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> distance </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> radius</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// angular distance in radians</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δφ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">δ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(θ);</span></span><span class="pln"><span class="pln">
        let </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δφ;</span></span><span class="pln"><span class="pln">

        </span></span><span class="com"><span class="com">// check for some daft bugger going past the pole, normalise latitude if so</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">abs</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&gt;</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">π</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&gt;</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">0</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">?</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">π</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-π</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δψ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">log</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">π</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">4</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">π</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">4</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> q </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">abs</span></span><span class="pun"><span class="pun">(Δψ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&gt;</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">10e-12</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">?</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δφ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δψ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// E-W course becomes ill-conditioned with 0/0</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">δ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(θ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> q</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ;</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> lat </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2.toDegrees</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> lon </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">2.toDegrees</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> lon</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">


    </span></span><span class="com"><span class="com">/**
     * Returns the loxodromic midpoint (along a rhumb line) between ‘this’ point and second point.
     *
     * @param   {LatLon} point - Latitude/longitude of second point.
     * @returns {LatLon} Midpoint between this point and second point.
     *
     * @example
     *   const p1 = new LatLon(51.127, 1.338);
     *   const p2 = new LatLon(50.964, 1.853);
     *   const pMid = p1.rhumbMidpointTo(p2); // 51.0455°N, 001.5957°E
     */</span></span><span class="pln"><span class="pln">
    rhumbMidpointTo</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(!(</span></span><span class="pln"><span class="pln">point </span></span><span class="kwd"><span class="kwd">instanceof</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> point </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">parse</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// allow literal forms</span></span><span class="pln"><span class="pln">

        </span></span><span class="com"><span class="com">// see mathforum.org/kb/message.jspa?messageID=148837</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln"> let </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> point</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">(),</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> point</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">abs</span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&gt;</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">π)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+=</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">π;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// crossing anti-meridian</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">3</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> f1 </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(π</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">4</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> f2 </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(π</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">4</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> f3 </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(π</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">4</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">3</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
        let </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">3</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">((λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">log</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">f3</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">log</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">f2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">log</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">f1</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">log</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">f2 </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> f1</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(!</span></span><span class="pln"><span class="pln">isFinite</span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">3</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">3</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// parallel of latitude</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> lat </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">3.toDegrees</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> lon </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">3.toDegrees</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> lon</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">


    </span></span><span class="com"><span class="com">/* Area - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */</span></span><span class="pln"><span class="pln">


    </span></span><span class="com"><span class="com">/**
     * Calculates the area of a spherical polygon where the sides of the polygon are great circle
     * arcs joining the vertices.
     *
     * @param   {LatLon[]} polygon - Array of points defining vertices of the polygon.
     * @param   {number}   [radius=6371e3] - (Mean) radius of earth (defaults to radius in metres).
     * @returns {number}   The area of the polygon in the same units as radius.
     *
     * @example
     *   const polygon = [new LatLon(0,0), new LatLon(1,0), new LatLon(0,1)];
     *   const area = LatLon.areaOf(polygon); // 6.18e9 m²
     */</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">static</span></span><span class="pln"><span class="pln"> areaOf</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">polygon</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> radius</span></span><span class="pun"><span class="pun">=</span></span><span class="lit"><span class="lit">6371e3</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="com"><span class="com">// uses method due to Karney: osgeo-org.1560.x6.nabble.com/Area-of-a-spherical-polygon-td3841625.html;</span></span><span class="pln"><span class="pln">
        </span></span><span class="com"><span class="com">// for each edge of the polygon, tan(E/2) = tan(Δλ/2)·(tan(φ₁/2)+tan(φ₂/2)) / (1+tan(φ₁/2)·tan(φ₂/2))</span></span><span class="pln"><span class="pln">
        </span></span><span class="com"><span class="com">// where E is the spherical excess of the trapezium obtained by extending the edge to the equator</span></span><span class="pln"><span class="pln">
        </span></span><span class="com"><span class="com">// (Karney's method is probably more efficient than the more widely known L’Huilier’s Theorem)</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> R </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> radius</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">

        </span></span><span class="com"><span class="com">// close polygon so that last point equals first point</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> closed </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> polygon</span></span><span class="pun"><span class="pun">[</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">].</span></span><span class="pln"><span class="pln">equals</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">polygon</span></span><span class="pun"><span class="pun">[</span></span><span class="pln"><span class="pln">polygon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">length</span></span><span class="pun"><span class="pun">-</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">]);</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(!</span></span><span class="pln"><span class="pln">closed</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> polygon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">push</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">polygon</span></span><span class="pun"><span class="pun">[</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">]);</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> nVertices </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> polygon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">length </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">

        let S </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// spherical excess in steradians</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">for</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">let v</span></span><span class="pun"><span class="pun">=</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> v</span></span><span class="pun"><span class="pun">&lt;</span></span><span class="pln"><span class="pln">nVertices</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> v</span></span><span class="pun"><span class="pun">++)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
            </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> polygon</span></span><span class="pun"><span class="pun">[</span></span><span class="pln"><span class="pln">v</span></span><span class="pun"><span class="pun">].</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
            </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> polygon</span></span><span class="pun"><span class="pun">[</span></span><span class="pln"><span class="pln">v</span></span><span class="pun"><span class="pun">+</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">].</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
            </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">polygon</span></span><span class="pun"><span class="pun">[</span></span><span class="pln"><span class="pln">v</span></span><span class="pun"><span class="pun">+</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">].</span></span><span class="pln"><span class="pln">lon </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> polygon</span></span><span class="pun"><span class="pun">[</span></span><span class="pln"><span class="pln">v</span></span><span class="pun"><span class="pun">].</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
            </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> E </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">atan2</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(Δλ/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)+</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)),</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln">
            S </span></span><span class="pun"><span class="pun">+=</span></span><span class="pln"><span class="pln"> E</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
        </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">isPoleEnclosedBy</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">polygon</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> S </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">abs</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">S</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">*π;</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> A </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">abs</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">S </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> R</span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln">R</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// area in units of R</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(!</span></span><span class="pln"><span class="pln">closed</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> polygon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">pop</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// restore polygon to pristine condition</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> A</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">

        </span></span><span class="com"><span class="com">// returns whether polygon encloses pole: sum of course deltas around pole is 0° rather than</span></span><span class="pln"><span class="pln">
        </span></span><span class="com"><span class="com">// normal ±360°: blog.element84.com/determining-if-a-spherical-polygon-contains-a-pole.html</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">function</span></span><span class="pln"><span class="pln"> isPoleEnclosedBy</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">p</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
            </span></span><span class="com"><span class="com">// TODO: any better test than this?</span></span><span class="pln"><span class="pln">
            let </span></span><span class="pun"><span class="pun">ΣΔ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
            let prevBrng </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> p</span></span><span class="pun"><span class="pun">[</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">].</span></span><span class="pln"><span class="pln">initialBearingTo</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">p</span></span><span class="pun"><span class="pun">[</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">]);</span></span><span class="pln"><span class="pln">
            </span></span><span class="kwd"><span class="kwd">for</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">let v</span></span><span class="pun"><span class="pun">=</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> v</span></span><span class="pun"><span class="pun">&lt;</span></span><span class="pln"><span class="pln">p</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">length</span></span><span class="pun"><span class="pun">-</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> v</span></span><span class="pun"><span class="pun">++)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
                </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> initBrng </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> p</span></span><span class="pun"><span class="pun">[</span></span><span class="pln"><span class="pln">v</span></span><span class="pun"><span class="pun">].</span></span><span class="pln"><span class="pln">initialBearingTo</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">p</span></span><span class="pun"><span class="pun">[</span></span><span class="pln"><span class="pln">v</span></span><span class="pun"><span class="pun">+</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">]);</span></span><span class="pln"><span class="pln">
                </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> finalBrng </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> p</span></span><span class="pun"><span class="pun">[</span></span><span class="pln"><span class="pln">v</span></span><span class="pun"><span class="pun">].</span></span><span class="pln"><span class="pln">finalBearingTo</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">p</span></span><span class="pun"><span class="pun">[</span></span><span class="pln"><span class="pln">v</span></span><span class="pun"><span class="pun">+</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">]);</span></span><span class="pln"><span class="pln">
                </span></span><span class="pun"><span class="pun">ΣΔ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">initBrng </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> prevBrng </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">540</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">%</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">360</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">180</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
                </span></span><span class="pun"><span class="pun">ΣΔ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">finalBrng </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> initBrng </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">540</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">%</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">360</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">180</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
                prevBrng </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> finalBrng</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
            </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">
            </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> initBrng </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> p</span></span><span class="pun"><span class="pun">[</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">].</span></span><span class="pln"><span class="pln">initialBearingTo</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">p</span></span><span class="pun"><span class="pun">[</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">]);</span></span><span class="pln"><span class="pln">
            </span></span><span class="pun"><span class="pun">ΣΔ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">initBrng </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> prevBrng </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">540</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">%</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">360</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">180</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
            </span></span><span class="com"><span class="com">// TODO: fix (intermittant) edge crossing pole - eg (85,90), (85,0), (85,-90)</span></span><span class="pln"><span class="pln">
            </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> enclosed </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">abs</span></span><span class="pun"><span class="pun">(ΣΔ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&lt;</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">90</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// 0°-ish</span></span><span class="pln"><span class="pln">
            </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> enclosed</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
        </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">


    </span></span><span class="com"><span class="com">/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */</span></span><span class="pln"><span class="pln">


    </span></span><span class="com"><span class="com">/**
     * Checks if another point is equal to ‘this’ point.
     *
     * @param   {LatLon} point - Point to be compared against this point.
     * @returns {bool}   True if points have identical latitude and longitude values.
     *
     * @example
     *   const p1 = new LatLon(52.205, 0.119);
     *   const p2 = new LatLon(52.205, 0.119);
     *   const equal = p1.equals(p2); // true
     */</span></span><span class="pln"><span class="pln">
    equals</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(!(</span></span><span class="pln"><span class="pln">point </span></span><span class="kwd"><span class="kwd">instanceof</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> point </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">parse</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// allow literal forms</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">abs</span></span><span class="pun"><span class="pun">(</span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> point</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&gt;</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Number</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">EPSILON</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">false</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">abs</span></span><span class="pun"><span class="pun">(</span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> point</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&gt;</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Number</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">EPSILON</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">false</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">true</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">


    </span></span><span class="com"><span class="com">/**
     * Converts ‘this’ point to a GeoJSON object.
     *
     * @returns {Object} this point as a GeoJSON ‘Point’ object.
     */</span></span><span class="pln"><span class="pln">
    toGeoJSON</span></span><span class="pun"><span class="pun">()</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln"> type</span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'Point'</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> coordinates</span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">[</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat </span></span><span class="pun"><span class="pun">]</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">};</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">


    </span></span><span class="com"><span class="com">/**
     * Returns a string representation of ‘this’ point, formatted as degrees, degrees+minutes, or
     * degrees+minutes+seconds.
     *
     * @param   {string} [format=d] - Format point as 'd', 'dm', 'dms', or 'n' for signed numeric.
     * @param   {number} [dp=4|2|0] - Number of decimal places to use: default 4 for d, 2 for dm, 0 for dms.
     * @returns {string} Comma-separated formatted latitude/longitude.
     * @throws  {RangeError} Invalid format.
     *
     * @example
     *   const greenwich = new LatLon(51.47788, -0.00147);
     *   const d = greenwich.toString();                        // 51.4779°N, 000.0015°W
     *   const dms = greenwich.toString('dms', 2);              // 51°28′40.37″N, 000°00′05.29″W
     *   const [lat, lon] = greenwich.toString('n').split(','); // 51.4779, -0.0015
     */</span></span><span class="pln"><span class="pln">
    toString</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">format</span></span><span class="pun"><span class="pun">=</span></span><span class="str"><span class="str">'d'</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> dp</span></span><span class="pun"><span class="pun">=</span></span><span class="kwd"><span class="kwd">undefined</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="com"><span class="com">// note: explicitly set dp to undefined for passing through to toLat/toLon</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(![</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'d'</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'dm'</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'dms'</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'n'</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">].</span></span><span class="pln"><span class="pln">includes</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">format</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">throw</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">RangeError</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">`invalid format ‘${format}’`</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">format </span></span><span class="pun"><span class="pun">==</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'n'</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// signed numeric degrees</span></span><span class="pln"><span class="pln">
            </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">dp </span></span><span class="pun"><span class="pun">==</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">undefined</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> dp </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">4</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
            </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">`${this.lat.toFixed(dp)},${this.lon.toFixed(dp)}`</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
        </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> lat </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toLat</span></span><span class="pun"><span class="pun">(</span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> format</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> dp</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> lon </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toLon</span></span><span class="pun"><span class="pun">(</span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> format</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> dp</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">`${lat}, ${lon}`</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">

</span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">


</span></span><span class="com"><span class="com">/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */</span></span><span class="pln"><span class="pln">

</span></span><span class="kwd"><span class="kwd">export</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLonSpherical</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">as</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">default</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">};</span></span></pre>

<hr class="fullwidth">
<pre class="fullwidth code prettyprint" id="dms-src"><span class="com"><span class="com">/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */</span></span><span class="pln"><span class="pln">
</span></span><span class="com"><span class="com">/* Geodesy representation conversion functions                        (c) Chris Veness 2002-2019  */</span></span><span class="pln"><span class="pln">
</span></span><span class="com"><span class="com">/*                                                                                   MIT Licence  */</span></span><span class="pln"><span class="pln">
</span></span><span class="com"><span class="com">/* www.movable-type.co.uk/scripts/latlong.html                                                    */</span></span><span class="pln"><span class="pln">
</span></span><span class="com"><span class="com">/* www.movable-type.co.uk/scripts/js/geodesy/geodesy-library.html#dms                             */</span></span><span class="pln"><span class="pln">
</span></span><span class="com"><span class="com">/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */</span></span><span class="pln"><span class="pln">

</span></span><span class="com"><span class="com">/* eslint no-irregular-whitespace: [2, { skipComments: true }] */</span></span><span class="pln"><span class="pln">


</span></span><span class="com"><span class="com">/**
 * Latitude/longitude points may be represented as decimal degrees, or subdivided into sexagesimal
 * minutes and seconds. This module provides methods for parsing and representing degrees / minutes
 * / seconds.
 *
 * @module dms
 */</span></span><span class="pln"><span class="pln">


</span></span><span class="com"><span class="com">/* Degree-minutes-seconds (&amp; cardinal directions) separator character */</span></span><span class="pln"><span class="pln">
let dmsSeparator </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'\u202f'</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// U+202F = 'narrow no-break space'</span></span><span class="pln"><span class="pln">


</span></span><span class="com"><span class="com">/**
 * Functions for parsing and representing degrees / minutes / seconds.
 */</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">class</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">

    </span></span><span class="com"><span class="com">// note Unicode Degree = U+00B0. Prime = U+2032, Double prime = U+2033</span></span><span class="pln"><span class="pln">

    </span></span><span class="com"><span class="com">/**
     * Separator character to be used to separate degrees, minutes, seconds, and cardinal directions.
     *
     * Default separator is U+202F ‘narrow no-break space’.
     *
     * To change this (e.g. to empty string or full space), set Dms.separator prior to invoking
     * formatting.
     *
     * @example
     *   import LatLon, { Dms } from '/js/geodesy/latlon-spherical.js';
     *   const p = new LatLon(51.2, 0.33).toString('dms');  // 51° 12′ 00″ N, 000° 19′ 48″ E
     *   Dms.separator = '';                                // no separator
     *   const pʹ = new LatLon(51.2, 0.33).toString('dms'); // 51°12′00″N, 000°19′48″E
     */</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">static</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">get</span></span><span class="pln"><span class="pln"> separator</span></span><span class="pun"><span class="pun">()</span></span><span class="pln"><span class="pln">     </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> dmsSeparator</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">static</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">set</span></span><span class="pln"><span class="pln"> separator</span></span><span class="pun"><span class="pun">(</span></span><span class="kwd"><span class="kwd">char</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln"> dmsSeparator </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">char</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">


    </span></span><span class="com"><span class="com">/**
     * Parses string representing degrees/minutes/seconds into numeric degrees.
     *
     * This is very flexible on formats, allowing signed decimal degrees, or deg-min-sec optionally
     * suffixed by compass direction (NSEW); a variety of separators are accepted. Examples -3.62,
     * '3 37 12W', '3°37′12″W'.
     *
     * Thousands/decimal separators must be comma/dot; use Dms.fromLocale to convert locale-specific
     * thousands/decimal separators.
     *
     * @param   {string|number} dms - Degrees or deg/min/sec in variety of formats.
     * @returns {number}        Degrees as decimal number.
     *
     * @example
     *   const lat = Dms.parse('51° 28′ 40.37″ N');
     *   const lon = Dms.parse('000° 00′ 05.29″ W');
     *   const p1 = new LatLon(lat, lon); // 51.4779°N, 000.0015°W
     */</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">static</span></span><span class="pln"><span class="pln"> parse</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">dms</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="com"><span class="com">// check for signed decimal degrees without NSEW, if so return it directly</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(!</span></span><span class="pln"><span class="pln">isNaN</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">parseFloat</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">dms</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&amp;&amp;</span></span><span class="pln"><span class="pln"> isFinite</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">dms</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Number</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">dms</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">

        </span></span><span class="com"><span class="com">// strip off any sign or compass dir'n &amp; split out separate d/m/s</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> dmsParts </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">String</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">dms</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">trim</span></span><span class="pun"><span class="pun">().</span></span><span class="pln"><span class="pln">replace</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">/^-/</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">''</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">replace</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">/[NSEW]$/</span></span><span class="pln"><span class="pln">i</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">''</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">split</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">/[^0-9.,]+/</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">dmsParts</span></span><span class="pun"><span class="pun">[</span></span><span class="pln"><span class="pln">dmsParts</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">length</span></span><span class="pun"><span class="pun">-</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">]==</span></span><span class="str"><span class="str">''</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> dmsParts</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">splice</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">dmsParts</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">length</span></span><span class="pun"><span class="pun">-</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">  </span></span><span class="com"><span class="com">// from trailing symbol</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">dmsParts </span></span><span class="pun"><span class="pun">==</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">''</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">NaN</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">

        </span></span><span class="com"><span class="com">// and convert to decimal degrees...</span></span><span class="pln"><span class="pln">
        let deg </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">null</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">switch</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">dmsParts</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">length</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
            </span></span><span class="kwd"><span class="kwd">case</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">3</span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln">  </span></span><span class="com"><span class="com">// interpret 3-part result as d/m/s</span></span><span class="pln"><span class="pln">
                deg </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> dmsParts</span></span><span class="pun"><span class="pun">[</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">]/</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> dmsParts</span></span><span class="pun"><span class="pun">[</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">]/</span></span><span class="lit"><span class="lit">60</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> dmsParts</span></span><span class="pun"><span class="pun">[</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">]/</span></span><span class="lit"><span class="lit">3600</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
                </span></span><span class="kwd"><span class="kwd">break</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
            </span></span><span class="kwd"><span class="kwd">case</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln">  </span></span><span class="com"><span class="com">// interpret 2-part result as d/m</span></span><span class="pln"><span class="pln">
                deg </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> dmsParts</span></span><span class="pun"><span class="pun">[</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">]/</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> dmsParts</span></span><span class="pun"><span class="pun">[</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">]/</span></span><span class="lit"><span class="lit">60</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
                </span></span><span class="kwd"><span class="kwd">break</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
            </span></span><span class="kwd"><span class="kwd">case</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln">  </span></span><span class="com"><span class="com">// just d (possibly decimal) or non-separated dddmmss</span></span><span class="pln"><span class="pln">
                deg </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> dmsParts</span></span><span class="pun"><span class="pun">[</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">];</span></span><span class="pln"><span class="pln">
                </span></span><span class="com"><span class="com">// check for fixed-width unseparated format eg 0033709W</span></span><span class="pln"><span class="pln">
                </span></span><span class="com"><span class="com">//if (/[NS]/i.test(dmsParts)) deg = '0' + deg;  // - normalise N/S to 3-digit degrees</span></span><span class="pln"><span class="pln">
                </span></span><span class="com"><span class="com">//if (/[0-9]{7}/.test(deg)) deg = deg.slice(0,3)/1 + deg.slice(3,5)/60 + deg.slice(5)/3600;</span></span><span class="pln"><span class="pln">
                </span></span><span class="kwd"><span class="kwd">break</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
            </span></span><span class="kwd"><span class="kwd">default</span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln">
                </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">NaN</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
        </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">/^-|[WS]$/</span></span><span class="pln"><span class="pln">i</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">test</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">trim</span></span><span class="pun"><span class="pun">()))</span></span><span class="pln"><span class="pln"> deg </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln">deg</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// take '-', west and south as -ve</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Number</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">deg</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">


    </span></span><span class="com"><span class="com">/**
     * Converts decimal degrees to deg/min/sec format
     *  - degree, prime, double-prime symbols are added, but sign is discarded, though no compass
     *    direction is added.
     *  - degrees are zero-padded to 3 digits; for degrees latitude, use .slice(1) to remove leading
     *    zero.
     *
     * @private
     * @param   {number} deg - Degrees to be formatted as specified.
     * @param   {string} [format=d] - Return value as 'd', 'dm', 'dms' for deg, deg+min, deg+min+sec.
     * @param   {number} [dp=4|2|0] - Number of decimal places to use – default 4 for d, 2 for dm, 0 for dms.
     * @returns {string} Degrees formatted as deg/min/secs according to specified format.
     */</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">static</span></span><span class="pln"><span class="pln"> toDms</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">deg</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> format</span></span><span class="pun"><span class="pun">=</span></span><span class="str"><span class="str">'d'</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> dp</span></span><span class="pun"><span class="pun">=</span></span><span class="kwd"><span class="kwd">undefined</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">isNaN</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">deg</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">null</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">  </span></span><span class="com"><span class="com">// give up here if we can't make a number from deg</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="kwd"><span class="kwd">typeof</span></span><span class="pln"><span class="pln"> deg </span></span><span class="pun"><span class="pun">==</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'string'</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&amp;&amp;</span></span><span class="pln"><span class="pln"> deg</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">trim</span></span><span class="pun"><span class="pun">()</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">==</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">''</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">null</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="kwd"><span class="kwd">typeof</span></span><span class="pln"><span class="pln"> deg </span></span><span class="pun"><span class="pun">==</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'boolean'</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">null</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">deg </span></span><span class="pun"><span class="pun">==</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">Infinity</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">null</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">deg </span></span><span class="pun"><span class="pun">==</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">null</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">null</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">

        </span></span><span class="com"><span class="com">// default values</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">dp </span></span><span class="pun"><span class="pun">===</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">undefined</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
            </span></span><span class="kwd"><span class="kwd">switch</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">format</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
                </span></span><span class="kwd"><span class="kwd">case</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'d'</span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln">   </span></span><span class="kwd"><span class="kwd">case</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'deg'</span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln">         dp </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">4</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">break</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
                </span></span><span class="kwd"><span class="kwd">case</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'dm'</span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln">  </span></span><span class="kwd"><span class="kwd">case</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'deg+min'</span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln">     dp </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">break</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
                </span></span><span class="kwd"><span class="kwd">case</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'dms'</span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">case</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'deg+min+sec'</span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> dp </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">break</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
                </span></span><span class="kwd"><span class="kwd">default</span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln">          format </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'d'</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> dp </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">4</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">break</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// be forgiving on invalid format</span></span><span class="pln"><span class="pln">
            </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">
        </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">

        deg </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">abs</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">deg</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">  </span></span><span class="com"><span class="com">// (unsigned result ready for appending compass dir'n)</span></span><span class="pln"><span class="pln">

        let dms </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">null</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> d </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">null</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> m </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">null</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> s </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">null</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">switch</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">format</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
            </span></span><span class="kwd"><span class="kwd">default</span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// invalid format spec!</span></span><span class="pln"><span class="pln">
            </span></span><span class="kwd"><span class="kwd">case</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'d'</span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">case</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'deg'</span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln">
                d </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> deg</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toFixed</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">dp</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">                       </span></span><span class="com"><span class="com">// round/right-pad degrees</span></span><span class="pln"><span class="pln">
                </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">d</span></span><span class="pun"><span class="pun">&lt;</span></span><span class="lit"><span class="lit">100</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> d </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'0'</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> d</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">                    </span></span><span class="com"><span class="com">// left-pad with leading zeros (note may include decimals)</span></span><span class="pln"><span class="pln">
                </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">d</span></span><span class="pun"><span class="pun">&lt;</span></span><span class="lit"><span class="lit">10</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> d </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'0'</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> d</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
                dms </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> d </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'°'</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
                </span></span><span class="kwd"><span class="kwd">break</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
            </span></span><span class="kwd"><span class="kwd">case</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'dm'</span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">case</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'deg+min'</span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln">
                d </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">floor</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">deg</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">                       </span></span><span class="com"><span class="com">// get component deg</span></span><span class="pln"><span class="pln">
                m </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">((</span></span><span class="pln"><span class="pln">deg</span></span><span class="pun"><span class="pun">*</span></span><span class="lit"><span class="lit">60</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">%</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">60</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toFixed</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">dp</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">           </span></span><span class="com"><span class="com">// get component min &amp; round/right-pad</span></span><span class="pln"><span class="pln">
                </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">m </span></span><span class="pun"><span class="pun">==</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">60</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln"> m </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toFixed</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">dp</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln"> d</span></span><span class="pun"><span class="pun">++;</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// check for rounding up</span></span><span class="pln"><span class="pln">
                d </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">'000'</span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln">d</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">slice</span></span><span class="pun"><span class="pun">(-</span></span><span class="lit"><span class="lit">3</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">                   </span></span><span class="com"><span class="com">// left-pad with leading zeros</span></span><span class="pln"><span class="pln">
                </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">m</span></span><span class="pun"><span class="pun">&lt;</span></span><span class="lit"><span class="lit">10</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> m </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'0'</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> m</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">                     </span></span><span class="com"><span class="com">// left-pad with leading zeros (note may include decimals)</span></span><span class="pln"><span class="pln">
                dms </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> d </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'°'</span></span><span class="pun"><span class="pun">+</span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">separator </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> m </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'′'</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
                </span></span><span class="kwd"><span class="kwd">break</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
            </span></span><span class="kwd"><span class="kwd">case</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'dms'</span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">case</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'deg+min+sec'</span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln">
                d </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">floor</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">deg</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">                       </span></span><span class="com"><span class="com">// get component deg</span></span><span class="pln"><span class="pln">
                m </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">floor</span></span><span class="pun"><span class="pun">((</span></span><span class="pln"><span class="pln">deg</span></span><span class="pun"><span class="pun">*</span></span><span class="lit"><span class="lit">3600</span></span><span class="pun"><span class="pun">)/</span></span><span class="lit"><span class="lit">60</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">%</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">60</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">        </span></span><span class="com"><span class="com">// get component min</span></span><span class="pln"><span class="pln">
                s </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">deg</span></span><span class="pun"><span class="pun">*</span></span><span class="lit"><span class="lit">3600</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">%</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">60</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toFixed</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">dp</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">           </span></span><span class="com"><span class="com">// get component sec &amp; round/right-pad</span></span><span class="pln"><span class="pln">
                </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">s </span></span><span class="pun"><span class="pun">==</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">60</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln"> s </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toFixed</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">dp</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln"> m</span></span><span class="pun"><span class="pun">++;</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// check for rounding up</span></span><span class="pln"><span class="pln">
                </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">m </span></span><span class="pun"><span class="pun">==</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">60</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln"> m </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> d</span></span><span class="pun"><span class="pun">++;</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">               </span></span><span class="com"><span class="com">// check for rounding up</span></span><span class="pln"><span class="pln">
                d </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">'000'</span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln">d</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">slice</span></span><span class="pun"><span class="pun">(-</span></span><span class="lit"><span class="lit">3</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">                   </span></span><span class="com"><span class="com">// left-pad with leading zeros</span></span><span class="pln"><span class="pln">
                m </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">'00'</span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln">m</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">slice</span></span><span class="pun"><span class="pun">(-</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">                    </span></span><span class="com"><span class="com">// left-pad with leading zeros</span></span><span class="pln"><span class="pln">
                </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">s</span></span><span class="pun"><span class="pun">&lt;</span></span><span class="lit"><span class="lit">10</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> s </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'0'</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> s</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">                     </span></span><span class="com"><span class="com">// left-pad with leading zeros (note may include decimals)</span></span><span class="pln"><span class="pln">
                dms </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> d </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'°'</span></span><span class="pun"><span class="pun">+</span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">separator </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> m </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'′'</span></span><span class="pun"><span class="pun">+</span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">separator </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> s </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'″'</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
                </span></span><span class="kwd"><span class="kwd">break</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
        </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> dms</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">


    </span></span><span class="com"><span class="com">/**
     * Converts numeric degrees to deg/min/sec latitude (2-digit degrees, suffixed with N/S).
     *
     * @param   {number} deg - Degrees to be formatted as specified.
     * @param   {string} [format=d] - Return value as 'd', 'dm', 'dms' for deg, deg+min, deg+min+sec.
     * @param   {number} [dp=4|2|0] - Number of decimal places to use – default 4 for d, 2 for dm, 0 for dms.
     * @returns {string} Degrees formatted as deg/min/secs according to specified format.
     *
     * @example
     *   const lat = Dms.toLat(-3.62, 'dms'); // 3°37′12″S
     */</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">static</span></span><span class="pln"><span class="pln"> toLat</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">deg</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> format</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> dp</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> lat </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toDms</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">wrap90</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">deg</span></span><span class="pun"><span class="pun">),</span></span><span class="pln"><span class="pln"> format</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> dp</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> lat</span></span><span class="pun"><span class="pun">===</span></span><span class="kwd"><span class="kwd">null</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">?</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'–'</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">slice</span></span><span class="pun"><span class="pun">(</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">separator </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">deg</span></span><span class="pun"><span class="pun">&lt;</span></span><span class="lit"><span class="lit">0</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">?</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'S'</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'N'</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">  </span></span><span class="com"><span class="com">// knock off initial '0' for lat!</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">


    </span></span><span class="com"><span class="com">/**
     * Convert numeric degrees to deg/min/sec longitude (3-digit degrees, suffixed with E/W).
     *
     * @param   {number} deg - Degrees to be formatted as specified.
     * @param   {string} [format=d] - Return value as 'd', 'dm', 'dms' for deg, deg+min, deg+min+sec.
     * @param   {number} [dp=4|2|0] - Number of decimal places to use – default 4 for d, 2 for dm, 0 for dms.
     * @returns {string} Degrees formatted as deg/min/secs according to specified format.
     *
     * @example
     *   const lon = Dms.toLon(-3.62, 'dms'); // 3°37′12″W
     */</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">static</span></span><span class="pln"><span class="pln"> toLon</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">deg</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> format</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> dp</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> lon </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toDms</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">wrap180</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">deg</span></span><span class="pun"><span class="pun">),</span></span><span class="pln"><span class="pln"> format</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> dp</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> lon</span></span><span class="pun"><span class="pun">===</span></span><span class="kwd"><span class="kwd">null</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">?</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'–'</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> lon </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">separator </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">deg</span></span><span class="pun"><span class="pun">&lt;</span></span><span class="lit"><span class="lit">0</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">?</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'W'</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'E'</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">


    </span></span><span class="com"><span class="com">/**
     * Converts numeric degrees to deg/min/sec as a bearing (0°..360°).
     *
     * @param   {number} deg - Degrees to be formatted as specified.
     * @param   {string} [format=d] - Return value as 'd', 'dm', 'dms' for deg, deg+min, deg+min+sec.
     * @param   {number} [dp=4|2|0] - Number of decimal places to use – default 4 for d, 2 for dm, 0 for dms.
     * @returns {string} Degrees formatted as deg/min/secs according to specified format.
     *
     * @example
     *   const lon = Dms.toBrng(-3.62, 'dms'); // 356°22′48″
     */</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">static</span></span><span class="pln"><span class="pln"> toBrng</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">deg</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> format</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> dp</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> brng </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln">  </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toDms</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">wrap360</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">deg</span></span><span class="pun"><span class="pun">),</span></span><span class="pln"><span class="pln"> format</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> dp</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> brng</span></span><span class="pun"><span class="pun">===</span></span><span class="kwd"><span class="kwd">null</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">?</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'–'</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> brng</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">replace</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">'360'</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'0'</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">  </span></span><span class="com"><span class="com">// just in case rounding took us up to 360°!</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">


    </span></span><span class="com"><span class="com">/**
     * Converts DMS string from locale thousands/decimal separators to JavaScript comma/dot separators
     * for subsequent parsing.
     *
     * Both thousands and decimal separators must be followed by a numeric character, to facilitate
     * parsing of single lat/long string (in which whitespace must be left after the comma separator).
     *
     * @param   {string} str - Degrees/minutes/seconds formatted with locale separators.
     * @returns {string} Degrees/minutes/seconds formatted with standard Javascript separators.
     *
     * @example
     *   const lat = Dms.fromLocale('51°28′40,12″N');                          // '51°28′40.12″N' in France
     *   const p = new LatLon(Dms.fromLocale('51°28′40,37″N, 000°00′05,29″W'); // '51.4779°N, 000.0015°W' in France
     */</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">static</span></span><span class="pln"><span class="pln"> fromLocale</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">str</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> locale </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="lit"><span class="lit">123456.789</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toLocaleString</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> separator </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln"> thousands</span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> locale</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">slice</span></span><span class="pun"><span class="pun">(</span></span><span class="lit"><span class="lit">3</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">4</span></span><span class="pun"><span class="pun">),</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">decimal</span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> locale</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">slice</span></span><span class="pun"><span class="pun">(</span></span><span class="lit"><span class="lit">7</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">8</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">};</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> str</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">replace</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">separator</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">thousands</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'⁜'</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">replace</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">separator</span></span><span class="pun"><span class="pun">.</span></span><span class="kwd"><span class="kwd">decimal</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'.'</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">replace</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">'⁜'</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">','</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">


    </span></span><span class="com"><span class="com">/**
     * Converts DMS string from JavaScript comma/dot thousands/decimal separators to locale separators.
     *
     * Can also be used to format standard numbers such as distances.
     *
     * @param   {string} str - Degrees/minutes/seconds formatted with standard Javascript separators.
     * @returns {string} Degrees/minutes/seconds formatted with locale separators.
     *
     * @example
     *   const Dms.toLocale('123,456.789');                   // '123.456,789' in France
     *   const Dms.toLocale('51°28′40.12″N, 000°00′05.31″W'); // '51°28′40,12″N, 000°00′05,31″W' in France
     */</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">static</span></span><span class="pln"><span class="pln"> toLocale</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">str</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> locale </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="lit"><span class="lit">123456.789</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toLocaleString</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> separator </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln"> thousands</span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> locale</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">slice</span></span><span class="pun"><span class="pun">(</span></span><span class="lit"><span class="lit">3</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">4</span></span><span class="pun"><span class="pun">),</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">decimal</span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> locale</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">slice</span></span><span class="pun"><span class="pun">(</span></span><span class="lit"><span class="lit">7</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">8</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">};</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> str</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">replace</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">/,([0-9])/</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'⁜$1'</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">replace</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">'.'</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> separator</span></span><span class="pun"><span class="pun">.</span></span><span class="kwd"><span class="kwd">decimal</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">replace</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">'⁜'</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> separator</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">thousands</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">


    </span></span><span class="com"><span class="com">/**
     * Returns compass point (to given precision) for supplied bearing.
     *
     * @param   {number} bearing - Bearing in degrees from north.
     * @param   {number} [precision=3] - Precision (1:cardinal / 2:intercardinal / 3:secondary-intercardinal).
     * @returns {string} Compass point for supplied bearing.
     *
     * @example
     *   const point = Dms.compassPoint(24);    // point = 'NNE'
     *   const point = Dms.compassPoint(24, 1); // point = 'N'
     */</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">static</span></span><span class="pln"><span class="pln"> compassPoint</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">bearing</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> precision</span></span><span class="pun"><span class="pun">=</span></span><span class="lit"><span class="lit">3</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(![</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">3</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">].</span></span><span class="pln"><span class="pln">includes</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Number</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">precision</span></span><span class="pun"><span class="pun">)))</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">throw</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">RangeError</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">`invalid precision ‘${precision}’`</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
        </span></span><span class="com"><span class="com">// note precision could be extended to 4 for quarter-winds (eg NbNW), but I think they are little used</span></span><span class="pln"><span class="pln">

        bearing </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">wrap360</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">bearing</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// normalise to range 0..360°</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> cardinals </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">[</span></span><span class="pln"><span class="pln">
            </span></span><span class="str"><span class="str">'N'</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'NNE'</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'NE'</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'ENE'</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln">
            </span></span><span class="str"><span class="str">'E'</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'ESE'</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'SE'</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'SSE'</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln">
            </span></span><span class="str"><span class="str">'S'</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'SSW'</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'SW'</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'WSW'</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln">
            </span></span><span class="str"><span class="str">'W'</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'WNW'</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'NW'</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'NNW'</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">];</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> n </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">4</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">**(</span></span><span class="pln"><span class="pln">precision</span></span><span class="pun"><span class="pun">-</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// no of compass points at req’d precision (1=&gt;4, 2=&gt;8, 3=&gt;16)</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">const</span></span><span class="pln"><span class="pln"> cardinal </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> cardinals</span></span><span class="pun"><span class="pun">[</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">round</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">bearing</span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln">n</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">360</span></span><span class="pun"><span class="pun">)%</span></span><span class="pln"><span class="pln">n </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">16</span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln">n</span></span><span class="pun"><span class="pun">];</span></span><span class="pln"><span class="pln">

        </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> cardinal</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">


    </span></span><span class="com"><span class="com">/**
     * Constrain degrees to range 0..360 (e.g. for bearings); -1 =&gt; 359, 361 =&gt; 1.
     *
     * @private
     * @param {number} degrees
     * @returns degrees within range 0..360.
     */</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">static</span></span><span class="pln"><span class="pln"> wrap360</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">degrees</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">&lt;=</span></span><span class="pln"><span class="pln">degrees </span></span><span class="pun"><span class="pun">&amp;&amp;</span></span><span class="pln"><span class="pln"> degrees</span></span><span class="pun"><span class="pun">&lt;</span></span><span class="lit"><span class="lit">360</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> degrees</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// avoid rounding due to arithmetic ops if within range</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">degrees</span></span><span class="pun"><span class="pun">%</span></span><span class="lit"><span class="lit">360</span></span><span class="pun"><span class="pun">+</span></span><span class="lit"><span class="lit">360</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">%</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">360</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// sawtooth wave p:360, a:360</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">

    </span></span><span class="com"><span class="com">/**
     * Constrain degrees to range -180..+180 (e.g. for longitude); -181 =&gt; 179, 181 =&gt; -179.
     *
     * @private
     * @param {number} degrees
     * @returns degrees within range -180..+180.
     */</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">static</span></span><span class="pln"><span class="pln"> wrap180</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">degrees</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(-</span></span><span class="lit"><span class="lit">180</span></span><span class="pun"><span class="pun">&lt;</span></span><span class="pln"><span class="pln">degrees </span></span><span class="pun"><span class="pun">&amp;&amp;</span></span><span class="pln"><span class="pln"> degrees</span></span><span class="pun"><span class="pun">&lt;=</span></span><span class="lit"><span class="lit">180</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> degrees</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// avoid rounding due to arithmetic ops if within range</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">degrees</span></span><span class="pun"><span class="pun">+</span></span><span class="lit"><span class="lit">540</span></span><span class="pun"><span class="pun">)%</span></span><span class="lit"><span class="lit">360</span></span><span class="pun"><span class="pun">-</span></span><span class="lit"><span class="lit">180</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// sawtooth wave p:180, a:±180</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">

    </span></span><span class="com"><span class="com">/**
     * Constrain degrees to range -90..+90 (e.g. for latitude); -91 =&gt; -89, 91 =&gt; 89.
     *
     * @private
     * @param {number} degrees
     * @returns degrees within range -90..+90.
     */</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">static</span></span><span class="pln"><span class="pln"> wrap90</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">degrees</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(-</span></span><span class="lit"><span class="lit">90</span></span><span class="pun"><span class="pun">&lt;=</span></span><span class="pln"><span class="pln">degrees </span></span><span class="pun"><span class="pun">&amp;&amp;</span></span><span class="pln"><span class="pln"> degrees</span></span><span class="pun"><span class="pun">&lt;=</span></span><span class="lit"><span class="lit">90</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> degrees</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// avoid rounding due to arithmetic ops if within range</span></span><span class="pln"><span class="pln">
        </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">abs</span></span><span class="pun"><span class="pun">((</span></span><span class="pln"><span class="pln">degrees</span></span><span class="pun"><span class="pun">%</span></span><span class="lit"><span class="lit">360</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">270</span></span><span class="pun"><span class="pun">)%</span></span><span class="lit"><span class="lit">360</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">180</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">90</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// triangle wave p:360 a:±90 TODO: fix e.g. -315°</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">

</span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">


</span></span><span class="com"><span class="com">// Extend Number object with methods to convert between degrees &amp; radians</span></span><span class="pln"><span class="pln">
</span></span><span class="typ"><span class="typ">Number</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">prototype</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">function</span></span><span class="pun"><span class="pun">()</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">180</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">};</span></span><span class="pln"><span class="pln">
</span></span><span class="typ"><span class="typ">Number</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">prototype</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toDegrees </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">function</span></span><span class="pun"><span class="pun">()</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">180</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">};</span></span><span class="pln"><span class="pln">

</span></span><span class="com"><span class="com">/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */</span></span><span class="pln"><span class="pln">

</span></span><span class="kwd"><span class="kwd">export</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">default</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">;</span></span></pre>



</body></html>